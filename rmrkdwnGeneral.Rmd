---
title: "Rapport de projet, IF36"
author: "Oscar BENOIT - Clément MALIDOR - Albert ELOMBO"
output: 
  html_document:
    theme: journal
    toc: true
    toc_float: true
---
# Introduction

Ce document Rmarkdown fait office de rapport final au projet d'IF36. En effet, le but étant de choisir un jeu de données existant afin de réaliser une analyse sur ce dernier à l'aide de data visualisation.

### Notre DataSet

Nous avons choisi d’utiliser deux datasets portant sur la prédiction des résultats finaux de lycéens de deux établissements portugais : Paolo Cortez et Minho. Les résultats visibles dans les datasets concernent les mathématiques et le portugais et ce dernier a été conçu de telle sorte qu’on puisse connaître le niveau (la note) de chaque élève dans les deux matières.
Notre dataset contient 33 variables et 395 observations. Parmi les variables, on dénote 13 de type numériques, 12 catégorielles et 8 booléennes. Nous disposons donc à priori d’assez de données pour avoir un résultat significatif.
De façon générale, les variables nous donnent des informations sur l’environnement socio-culturel de l’élève à travers le milieu dans lequel il réside, les activités auxquelles il a accès et le background académique dont dispose ses parents. Nous retrouvons aussi des données relatives à la charge de travail de ces derniers ainsi que de leur état de santé.

### Nos graphs
Notre analyse portera sur 3 différents axes. Dans un premier temps, l'axe principal de notre reflexion sera l'analyse des notes en fonction de différents critères, de différentes variables, qui nous semblaient es plus intéressantes à l'analys. Le but étant de trouver le profil "type" de l'élève modèle (avec les meilleurs résultats). Puis, un deuxième axe de reflexion portera sur les relations familiales des élèves, en analysant quels sont les variables qui expliquent le mieux les bonnes relations familiales d'un élève. Enfin, nous avons choisi de travailler sur le plan santé, que doit faire un élève pour avoir la meilleure santé possible. Notre analyse comporte 30 graphs, ce qui est assez long mais nous avons jugé chaque graph présent comme indispensable à la bonne compréhension des axes de développement, afin que l'analyse soit la plus claire et précise possible.

# Importations des libraries

Importons ici toutes les libraries utiles à notre projet.

```{r import packages, message = FALSE}
library(readr)
library(ggplot2)
library(dplyr)
library(scales)
library(gridExtra)
library("viridis")
```

# Exploration des données
La première partie de notre projet a consisté en l'exploration de nos jeux de données. En effet, les individus n'étant pas les mêmes sur le dataset mathématiques et le dataset portugais, il nous était impossible de les regrouper. Cependant, nous avons tout de même choisi de garder les deux en réalisant nos graph sur le dataset que nous avons jugé le plus approprié selon les variables analysées. En effet, le dataset portugais comporte plus d'individus que le dataset mathématiques, donc lorsque nous avons réalisé les graph avec ce dernier c'est que nous voulions une bonne représentativité des individus. Au contraire, nous avons jugé que le dataset mathématiques nous était utile lorsque le sérieux des élèves primait sur le nombre d'élèves, car nous considérons que les mathématiques sont une une matière plus importante que le portugais et donc que les élèves étaient plus sérieux dans cette matière.

# Importation des dataset et datacleaning

Importons dans un premier temps les datasets. Lors de notre exploration de données, nous avons pu déceler deux problèmes qu'il fallait résoudre : le premier, le fait que la population de 20 ans et + était clairement négligeable dans les datasets et nous avons donc décidé de l'enlever pour pouvoir avoir une vision plus claire sur les 15 - 19 ans (âges lycéens). 

```{r repartition des ages, message = FALSE}
dfMathsComplet <- read_csv("data/student-mat.csv")
#preparation des donnees
df <- dfMathsComplet %>% select(age)

ggplot(df, aes(x = age)) +
  geom_bar(alpha = 0.7, fill = viridis(8)) + 
  labs(title = "Repartiton des effectifs selon l'age", x = "age", y = "effectifs")

```

Le deuxième problème était l'absence d'une moyenne générale sur l'année des élèves, en effet, la régularité des notes étant un critère à prendre en compte dans nos analyses, nous avons décidé de créer cette nouvelle variable "Gmean" qui est la moyenne des notes des élèves sur les toris trimestres. Ce sera cette variable sur laquelle nous nous baserons pour réalilser nos analyses des notes.  

```{r import datasets et traitements, message = FALSE}
dfMaths <- dfMathsComplet %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfMaths %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfMaths <- cbind(dfMaths, temp) %>% rename('Gmean' = `rowSums(temp)/3`)

#Visualisation du dataset
head(dfMaths)

dfPortugais <- read_csv("data/student-por.csv") %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfPortugais %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfPortugais <- cbind(dfPortugais, temp) %>% rename('Gmean' = `rowSums(temp)/3`)
head(dfPortugais)
```

# Comment être l'élève avec les meilleurs résultats ?

### L'importance d'internet 


```{r internet, message = FALSE}

notesSiInternet <- dfMaths %>% filter(internet == "yes") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiInternet <- notesSiInternet[1,1]

notesSiPasInternet <- dfMaths %>% filter(internet == "no") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiPasInternet <- notesSiPasInternet[1,1]
```

Voici la moyenne des notes des élèves ayant internet : `r notesSiInternet` qui est bien plus élevé que la moyenne des notes des élèves n'ayant pas internet : `r notesSiPasInternet`. L'importance d'avoir internet pour les études est bien visible ici.

### Habiter en ville, un avantage ?

```{r address, message = FALSE}
notesSiVille <- dfPortugais %>% filter(address == "U") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiVille <- notesSiVille[1,1]

notesSiCampagne <- dfPortugais %>% filter(address == "R") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiCampagne <- notesSiCampagne[1,1]
```

On peut avoir accès également à la moyenne des notes des élèves venant de la ville : `r notesSiVille` et celle de ceux venant de la campagne : `r notesSiCampagne`. On peut voir qu'en général, les personnes venant de la ville réussissent mieux que celles venant de la campagne. On peut se dire que le temps de trajet joue un grand rôle dans la réussite des élèves, et nous allons le vérifier.

### La nécessité de la proximité avec l'établissement 

```{r traveltime, message = FALSE}
dfPortugais$traveltime <- as.factor(dfPortugais$traveltime)
#preparation des données
df <- dfPortugais %>% group_by(traveltime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(traveltime, mean_Gmean)

ggplot(df, aes(x = traveltime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = traveltime)) +
    labs(title = "Notes en fonction du temps de trajet en Portugais", x = "traveltime", y = "moyenne des notes", fill = "traveltime") +
    scale_fill_discrete(type = "viridis")

```

En effet, les notes baissent plus le temps de trajet est long. Cela concore bien avec les résultats trouvés précédemment.

### Le métier des parents influe sur les notes

```{r fjob, message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Fjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Fjob, mean_Gmean)

#Barplot 
fJob <- ggplot(df, aes(x = Fjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity", fill = viridis(5), alpha = .7) +
    labs(x = "Job du père", y = "Gmean",title = "Moyenne selon le Job du père")
```

```{r mjob, message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Mjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Mjob, mean_Gmean)

#Barplot 
mJob <- ggplot(df, aes(x = Mjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity", fill = viridis(5), alpha = .7) +
    labs(x = "Job de la mère", y = "Gmean",title = "Moyenne selon le Job de la mère")

grid.arrange(fJob, mJob, ncol=2, nrow = 1)
```

On peut déceler que le métier du père et de la mère ont une influence sur les notes de l'étudiant. En effet, un père professeur amène généralement à de bien meilleurs résultats. Tandis que du côté de la mère, c'est le travail dans la santé qui permet d'avoir des meilleurs notes. On pourra voir par la suite si avoir une mère dans la santé implique être en bonne santé et donc conclure sur le fait qu'être en bonne santé a un impact direct sur les notes.

### Qui travaille le plus ? Et à quel prix ?

```{r studytime garcons filles}
tempsMoyenGarcons <- dfMaths %>% filter(sex == "M") %>% select(studytime) %>% mutate(mean_studytime = mean(studytime)) %>% distinct(mean_studytime)

tempsMoyenGarcons <- tempsMoyenGarcons[1,1]

tempsMoyenFilles <- dfMaths %>% filter(sex == "F") %>% select(studytime) %>% mutate(mean_studytime = mean(studytime)) %>% distinct(mean_studytime)

tempsMoyenFilles <- tempsMoyenFilles[1,1]
```

Voici le temps de travail en moyenne des garcons : `r tempsMoyenGarcons`

En comparaison au temps moyen des filles en Maths, qui est plus élevé : `r tempsMoyenFilles`


Regardons les notes en mathématiques selon le genre à l'aide d'un boxplot afin d'avoir plus de précision sur les différents quartiles. En y ajoutant un point blanc dans les boxplot qui symbolise la moyenne des notes.

```{r notes selon sexe, message = FALSE}
#preparation des données
df <- dfMaths %>% select(sex, Gmean)

#BoxPlot
ggplot(df, aes(x = sex, y = Gmean)) + 
  geom_boxplot(aes(fill = sex),alpha = .8,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Pastel2") +
  ggtitle("Répartition des notes en fonction du genre")
  
```

On peut voir que les garcons ont des meilleures notes que les filles, alors qu'ils travaillent moins en moyenne. On conclue qu'en théorie, il vaut mieux être un garcon pour réussir.

### Le temps, important pour s'aérer l'esprit

```{r freetime, message = FALSE}
dfPortugais$freetime <- as.factor(dfPortugais$freetime)
df <- dfPortugais %>% group_by(freetime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(freetime, mean_Gmean)

ggplot(df, aes(x = freetime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = freetime)) +
    geom_line(color = "blue") +
    labs(title = "Temps libre en fonction des notes", x = "temps libre", y = "moyenne des notes", fill = "Temps libre") +
    scale_fill_discrete(type = "viridis")
  
```

On peut voir que le fait de se libérer du temps libre est important pour réussir. En effet, ce sont les élèves qui se libérent un peu de temps libre (mais pas trop, niveau 2), qui obtiennent les meilleurs résultats.

### Pour réussir, il faut travailler

Voyons maintenant si le temps de travail implique des meilleurs notes, en Portugais :

```{r studytime, message = FALSE}
dfPortugais$studytime <- as.factor(dfPortugais$studytime)
#preparation des données
df <- dfPortugais %>% group_by(studytime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(studytime, mean_Gmean)

ggplot(df, aes(x = studytime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = studytime)) +
    geom_line(color = "blue") +
    labs(title = "Notes en fonction du temps de travail en Portugais", x = "temps de travail", y = "moyenne des notes", fill = "Temps de travail") +
    scale_fill_discrete(type = "viridis")
    
```

On voit que plus les élèves travaillent, meileures sont leurs notes, cependant, on voit que la différence n'est pas énorme, même négligeable, entre 3h et 4h. On pense alors que travailler plus de 3h n'est pas utile pour avoir de bonnes notes.

### Boire de l'alcool, c'est mal, mais un petit peu, ca ne fait pas de mal

```{r alcool le wknd, message = FALSE}
dfPortugais$Walc <- as.factor(dfPortugais$Walc)
df <- dfPortugais %>% group_by(Walc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Walc, mean_Gmean)

Walc <- ggplot(df, aes(x = Walc, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Walc)) +
    geom_line(color = "blue") +
    labs(title = "Conso d'alcool le wknd en fonction des notes", x = "conso d'alcool le wknd", y = "moyenne des notes", fill = "conso d'alcool") +
    scale_fill_discrete(type = "viridis")
  
```

On peut voir que la consommation d'alcool le weekend a clairement un impact sur les notes et que ce sont ceux qui en consomment peu (niveau 1 ou 2) qui ont les meilleures résultats. On peut donc considérer qu'il est préférable de ne pas consommer d'alcool le weekend, ou simplement un petit verre, pour avoir les meilleurs notes (s'amuser le weekend pour relacher les cours par exemple).

Est-ce la même conclusion pour l'alcool en semaine ? 

```{r alcool la semaine, message = FALSE}
dfPortugais$Dalc <- as.factor(dfPortugais$Dalc)
df <- dfPortugais %>% group_by(Dalc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Dalc, mean_Gmean)

Dalc <- ggplot(df, aes(x = Dalc, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Dalc)) +
    geom_line(color = "blue") +
    labs(title = "Notes selon la conso d'alcool en semaine", x = "Conso d'alcool en semaine", y = "moyenne des notes", fill = "conso d'alcool") +
    scale_fill_discrete(type = "viridis")
grid.arrange(Walc, Dalc, ncol=2, nrow = 1)

```

L'impact de la consommation d'alcool en semaine semble encore plus lourd, cette fois si, le niveau 1 de consommation (pas de consommation) est celui qui obtient les meilleures notes, et de loin. Cependant, quitte à boire beaucoup de l'alcool en semaine, autant en boire énormément car le niveau 5 obtient des meilleures notes que le niveau 4. (les résultats du niveau 5 sont sûrement tronquées par le fait que peu d'élèves sont au niveay 5, la représentativité est donc faible)

### Pour réussir, faut-il nécessairement aller en cours ?

```{r absences, message = FALSE}
#preparation des données
df <- dfMaths

ggplot(df, aes(x = absences, y = Gmean)) +
    geom_point() +
    geom_smooth() +
    labs(title = "Notes en fonction du nb d'absences en maths", x = "absences", y = "moyenne des notes")

```

Le nombre d'individus ayant plus de 15 absences est trop faible et le graph ne nous permet pas de conclure sur cela. Cependant, on voit qu'en dessous de 15 absences, les résultats ne varient que très peu.

### La volonté de faire des études supérieurs influe-t-elle ?

```{r etudes sup, message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(higher) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(higher, mean_Gmean)

ggplot(df, aes(x = higher, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.8, aes(fill = higher)) +
    labs(title = "Notes en fonction de la volonté de faire des études sup en Maths", x = "volonté de faire des études sup", y = "moyenne des notes", fill = "volonté de faire des études sup") +
  scale_fill_brewer(palette = "Pastel2")

```

En effet, on peut voir que la volonté de faire des études supérieures est très corrélées aux résultats.

### Le soutien scolaire, un vrai plus ?

```{r paid soutien scolaire, message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(paid) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(paid, mean_Gmean)

paid <- ggplot(df, aes(x = paid, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = paid)) +
    labs(title = "Notes selon soutien payant en Maths", x = "soutien scolaire payant", y = "moyenne des notes", fill = "élève soutenu") +
    scale_fill_brewer(palette = "Pastel2")

```

```{r soutien scolaire gratuit, message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(schoolsup) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(schoolsup, mean_Gmean)

schoolsup <- ggplot(df, aes(x = schoolsup, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = schoolsup)) +
    labs(title = "Notes selon soutien gratuit en Maths", x = "soutien scolaire gratuit", y = "moyenne des notes", fill = "élève soutenu") +
    scale_fill_brewer(palette = "Pastel2")

grid.arrange(schoolsup, paid, ncol=2, nrow = 1)

```

Les élèves ayant un soutien scolaire gratuit, donné par l'établissement semblent obtenir de bien moins bons résultats que les élèves ayant un soutien scolaire payant. En effet, on peut donc conclure sur le fait que le soutien scolaire gratuit est mis en place pour les élèves en difficulté, et que le soutien scolaire payant est clairement bénéfique pour les personnes qui le prenne.

### Les échecs ont un impact sur les notes

```{r echecs, message = FALSE}
dfPortugais$failures <- as.factor(dfPortugais$failures)
#preparation des données
df <- dfPortugais %>% group_by(failures) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(failures, mean_Gmean)

ggplot(df, aes(x = failures, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = failures)) +
    labs(title = "Notes en fonction du temps de trajet en Portugais", x = "failures", y = "moyenne des notes", fill = "nb de failures") +
    scale_fill_discrete(type = "viridis")

```

Enfin, on peut voir que les échecs dun élève influe directement sur ses notes. En effet, ce sont les élèves n'ayant jamais échoués qui s'en sortent le mieux, cela semble logique.

# Conclusion sur l'élève modèle

Enfin, on peut dire que nous avons pu déceler certains critères pour être l'élève modèle, ayant les meilleurs résultats. Il doit : 

- Habiter en ville afin d'avoir le plus petit temps de trajet possible
- Avoir un père travaillant en tant que professeur et/ou une mère dans la santé
- Être un garçon (conclusion très théorique, basé uniquement sur les données)
- Se dégager un peu de temps libre pour s'aérer l'esprit
- Travailler de manière conséquente, mais ne pas abuser du temps passé à étudier
- Ne surtout pas consommer d'alcool en semaine et ne pas en consommer le weekend, ou bien très peu.
- On imagine qu'un taux d'absentéisme élevé engendre des moins bonnes notes mais le dataset ne nous a pas permi de conclure là-dessus
- Avoir comme souhait de faire des études supérieurs
- Obtenir un soutien scolaire payant
- Ne jamais avoir eu d'échec

---------------------------------------------------------------

# Comment être l'élève qui s'entend le mieux avec sa famille ?

### Calcul des moyennes utiles à l'analyse des relations 

```{r calcul_moyenne_famrel, echo=FALSE}
#Moyenne générale des relations familales
total_famrel <- dfPortugais$famrel
mean_famrel <- round(mean(total_famrel), digits=2)

#Moyenne générale des relations familales selon le sexe
#Moyenne générale des relations familales pour les garçons
total_famrel_M <- dfPortugais %>%
  select(famrel, sex) %>%
  filter(sex == 'M')
total_famrel_M <- total_famrel_M$famrel
mean_famrel_M <- round(mean(total_famrel_M), digits=2)
#Moyenne générale des relations familales pour les filles
total_famrel_F <- dfPortugais %>%
  select(famrel, sex) %>%
  filter(sex == 'F')
total_famrel_F <- total_famrel_F$famrel
mean_famrel_F <- round(mean(total_famrel_F), digits=2)

#Moyenne générale des relations familales selon le lieu d'habitation
#Moyenne générale des relations familales pour les étudiants de la campagne
total_famrel_R <- dfPortugais %>%
  select(famrel, address) %>%
  filter(address == 'R')
total_famrel_R <- total_famrel_R$famrel
mean_famrel_R <- round(mean(total_famrel_R), digits=2)
#Moyenne générale des relations familales pour les étudiants de la ville
total_famrel_U <- dfPortugais %>%
  select(famrel, address) %>%
  filter(address == 'U')
total_famrel_U <- total_famrel_U$famrel
mean_famrel_U <- round(mean(total_famrel_U), digits=2)

#Moyenne générale des relations familales selon le statut marital des parents
#Moyenne générale des relations familales pour les étudiants ayant des parents séparés
total_famrel_PSA <- dfPortugais %>%
  select(famrel, Pstatus) %>%
  filter(Pstatus == 'A')
total_famrel_PSA <- total_famrel_PSA$famrel
mean_famrel_PSA <- round(mean(total_famrel_PSA), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant des parents ensembles
total_famrel_PST <- dfPortugais %>%
  select(famrel, Pstatus) %>%
  filter(Pstatus == 'T')
total_famrel_PST <- total_famrel_PST$famrel
mean_famrel_PST <- round(mean(total_famrel_PST), digits=2)

#Moyenne générale des relations familales selon l'âge
#Moyenne générale des relations familales pour les étudiants ayant 15 ans
total_famrel_15 <- dfPortugais %>%
  select(famrel, age) %>%
  filter(age == 15)
total_famrel_15 <- total_famrel_15$famrel
mean_famrel_15 <- round(mean(total_famrel_15), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant 16 ans
total_famrel_16 <- dfPortugais %>%
  select(famrel, age) %>%
  filter(age == 16)
total_famrel_16 <- total_famrel_16$famrel
mean_famrel_16 <- round(mean(total_famrel_16), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant 17 ans
total_famrel_17 <- dfPortugais %>%
  select(famrel, age) %>%
  filter(age == 17)
total_famrel_17 <- total_famrel_17$famrel
mean_famrel_17 <- round(mean(total_famrel_17), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant 20 ans
total_famrel_20 <- dfPortugais %>%
  select(famrel, age) %>%
  filter(age == 20)
total_famrel_20 <- total_famrel_20$famrel
mean_famrel_20 <- round(mean(total_famrel_20), digits=2)

#Moyenne générale des relations familales selon la taille de la famille
#Moyenne générale des relations familales pour les étudiants ayant une famille < ou = à 3 personnes
total_famrel_FSLE3 <- dfPortugais %>%
  select(famrel, famsize) %>%
  filter(famsize == 'LE3')
total_famrel_FSLE3 <- total_famrel_FSLE3$famrel
mean_famrel_FSLE3 <- round(mean(total_famrel_FSLE3), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant une famille > à 3 personnes
total_famrel_FSGT3 <- dfPortugais %>%
  select(famrel, famsize) %>%
  filter(famsize == 'GT3')
total_famrel_FSGT3 <- total_famrel_FSGT3$famrel
mean_famrel_FSGT3 <- round(mean(total_famrel_FSGT3), digits=2)
```


FIN PARTIE FAMREL
---------------------------------------------------------------

### Comment varient les relations familiales ?

La moyenne des relations familiales est de **`r mean_famrel`**.

```{r famrel, echo=FALSE}
ggplot(dfPortugais, aes(x = famrel)) + 
    geom_bar(alpha = 0.7, fill = viridis(5))+
    labs(x = "Relations familiales" , y = "Nombre d'étudiants" ,title = "Répartitions des relations familiales")
```





### Relations familiales selon le sexe et le lieu de vie

```{r sex_adress_famrel, echo=FALSE}
df <- dfPortugais %>% select(sex, famrel)

dfS <- ggplot(df, aes(x = sex, y = famrel)) + 
  geom_violin(aes(fill = sex),alpha = 0.6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  ggtitle("Relations familiales selon sexe")

df <- dfPortugais %>% select(address, famrel)

dfA <- ggplot(df, aes(x = address, y = famrel)) + 
  geom_violin(aes(fill = address),alpha = 0.6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  ggtitle("Relations familiales selon l'adresse")

grid.arrange(dfS, dfA, ncol=2, nrow = 1)
```

La moyenne des relations familiales chez les garçons est de  **`r mean_famrel_M`** 
tandis que chez les filles elle est de **`r mean_famrel_F`**.
Par rapport au lieu de vie, la moyenne des relations familiales des élèves habitant à la campagne est de  **`r mean_famrel_R`** tandis que chez les élèves habitant en ville, elle est de **`r mean_famrel_U`**.

**Le sexe et le lieu de vie n'influe donc pas ou peu les relations familiales.**

### Relations familiales selon l'âge

```{r age_famrel, echo=FALSE}
dfPortugais <- dfPortugais %>% filter (age != 21, age != 22)
dfPortugais$age <- as.factor(dfPortugais$age)
df <- dfPortugais %>% group_by(age) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(age, mean_famrel)

ggplot(df, aes(x = age, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = age)) +
    labs(title = "Relation familiales selon l'âge", x = "Âge", y = "Relations familiales", fill = "Âge") +
    scale_fill_discrete(type = "viridis")
```

Vu le faible nombre d'étudiants ayant 21 et 22 ans, on ne se concentre que la fourchette d'âge 15-20 ans. 
On peut voir que plus les étudiants viellissent, plus leur relations familiales se détériorent. De 17 à 20 ans, la moyenne des relations familiales passe de `r mean_famrel_17` à `r mean_famrel_20`.
Néanmoins, cette observation se retrouve un peu faussée par les étudiants de 16 ans, qui ont une moyenne de relations familiales à `r mean_famrel_16`, alors que pour ceux de 15 et 17 ans, elles sont respectivement de `r mean_famrel_15` et `r mean_famrel_17`.

### Relations familiales selon le statut marital des parents
En tant que tel, le statut marital des parents ne fais pas tant vairer les relations familailes. En effet, les étudiants avec des parents ensembles ont une moyenne de relation familiale qui est de `r mean_famrel_PST` tandis qu'elle est de `r mean_famrel_PSA` pour ceux qui ont leurs parents séparés.

Néanmoins, conjugué à d'autres paramètres, le statut marital des parents fait varier les relations familiales des étudiants.

### Relations familiales selon la taille de la famille en prenant en compte le statut marital des parents
```{r famsize_famrel, echo=FALSE}
df <- dfPortugais %>% filter(Pstatus == "T") %>% group_by(famsize) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(famsize, mean_famrel)

dfFSPT <- ggplot(df, aes(x = famsize, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = famsize)) +
    labs(title = "Famrel selon famsize parents ensembles", x = "Taille de la famille", y = "Relations familiales", fill = "Taille de la famille") +
    scale_fill_discrete(type = "viridis")

df <- dfPortugais %>% filter(Pstatus == "A") %>% group_by(famsize) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(famsize, mean_famrel)

dfFSPA <- ggplot(df, aes(x = famsize, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = famsize)) +
    labs(title = "Famrel selon famsize parents séparés", x = "Taille de la famille", y = "Relations familiales", fill = "Taille de la famille") +
    scale_fill_discrete(type = "viridis")

grid.arrange(dfFSPT, dfFSPA, ncol=2, nrow = 1)

```

Si on s'interesse seulement à la taille de la famille, les relations varient peu entre les familles de composées de 3 personnes ou moins **(`r mean_famrel_FSLE3`)**, et celle comptant plus de 3 personnes **(`r mean_famrel_FSGT3`)**. Néanmoins en regardant les relations familiales par rapport à la taille de famille, selon que les parents soient ensembles ou non, **les chiffres deviennent plus interessants**.

Même si pour les étudiants qui ont des **parents ensembles**, **les relations familiales varient peu**, les étudiants ayant des **parents séparés** ont de **meilleures relations familiales** lorsque la **taille de la famille est égale ou inférieure à 3**.


### Relations familiales selon le tuteur légal en prenant en compte le statut marital des parents

```{r guardian_famrel, echo=FALSE}
df <- dfPortugais %>% filter(Pstatus == "T") %>% group_by(guardian) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(guardian, mean_famrel)

dfGPT <- ggplot(df, aes(x = guardian, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = guardian)) +
  labs(title = "Relations familiales en fonction du tuteur légal pour parents ensemble", x = "Tuteur légal", y = "Relation familiale", fill = "Tuteur légal") +
    scale_fill_discrete(type = "viridis")

df <- dfPortugais %>% filter(Pstatus == "A") %>% group_by(guardian) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(guardian, mean_famrel)
dfGPA <- ggplot(df, aes(x = guardian, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = guardian)) +
  labs(title = "Relations familiales en fonction du tuteur légal pour parents séparés", x = "Tuteur légal", y = "Relation familiale", fill = "Tuteur légal") +
    scale_fill_discrete(type = "viridis")

df <- dfPortugais %>% filter(Pstatus == "T") %>% group_by(guardian) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(guardian, mean_famrel)


grid.arrange(dfGPT, dfGPA, ncol=2, nrow = 1)

```

Quand on s'interesse seulement aux relations familiales suivant le tuteur légal de l'élève, la moyenne varie peu (), sauf pour "autre" ou la moyenne est un poil plus bas.

En revanche, la donne est différentes lorsque l'on associe à cela le statut marital des parents. 
Pour des **parents ensembles**, les **relations familiales sont semblables** lorsque que le **père** ou la **mère** sont tuteurs. Cette même **moyenne est plus basse** quand c'est **quelqu'un d'autre** qui a le rôle de tuteur.

En revanche, pour des parents séparés, le résultat est bien différent. Les **relations familiales sont au plus bas** quand c'est **le père le tuteur**, est **au plus haut** quand c'est **quelqu'un d'autre**.  

### Relations familiales selon le travail
```{r Pjob_famrel, echo=FALSE}
df <- dfPortugais %>% group_by(Mjob) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Mjob, mean_famrel)

dfMJ <- ggplot(df, aes(x = Mjob, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Mjob)) +
  labs(title = "Relations familiales selon de maman", x = "Travail", y = "Relation familiale", fill = "Travail") +
    scale_fill_discrete(type = "viridis")

df <- dfMaths%>% group_by(Fjob) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Fjob, mean_famrel)

dfFJ <- ggplot(df, aes(x = Fjob, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Fjob)) +
  labs(title = "Relations familiales selon travail de papa", x = "Travail", y = "Relation familiale", fill = "Travail") +
    scale_fill_discrete(type = "viridis")

grid.arrange(dfMJ, dfFJ, ncol=2, nrow = 1)
```

Pour le père et la mère, on voit que les relations familiales sont mieux quand **l'un et l'autre** travaillent dans **le service public**.

Pour approfondir cette analyse, nous allons regarder : 
- quand le père travaille dans le service public, quel est le travail préférentiel pour la mère
- quand la mère travaille dans le service public, quel est le travail préférentiel pour le père

```{r Pjob2_famrel, echo=FALSE}
df <- dfMaths %>% filter(Mjob == 'services') %>% group_by(Fjob) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Fjob, mean_famrel)

ggplot(df, aes(x = Fjob, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Fjob)) +
  labs(title = "Relations familiales selon travail de papa", x = "Travail", y = "Relation familiale", fill = "Travail") +
    scale_fill_discrete(type = "viridis")

df <- dfPortugais %>% filter(Fjob == 'services') %>% group_by(Mjob) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Mjob, mean_famrel)

ggplot(df, aes(x = Mjob, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Mjob)) +
  labs(title = "Relations familiales selon de maman", x = "Travail", y = "Relation familiale", fill = "Travail") +
    scale_fill_discrete(type = "viridis")
```

Les résulatats sont sans appels !
Quand **le père** travaille dans **le service public**, il vaut que **la mère soit au foyer** pour avoir des meilleures relations familiales. 
En revanche, quand c'est **la mère** qui travaille dans **le service public**, les relations familiales se portent mieux si **le père est professeur**.

### Relations familiales selon l'éducation des parents
```{r Pedu_famrel, echo=FALSE}
#preparation des données
dfPortugais$Medu <- as.factor(dfPortugais$Medu)
df <- dfPortugais %>% group_by(Medu) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Medu, mean_famrel)

dfME <- ggplot(df, aes(x = Medu, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Medu)) +
    labs(title = "Relation familiales selon éducation de maman", x = "Education maman", y = "Relations familiales", fill = "Education maman") +
    scale_fill_discrete(labels = c("0 : Aucune", "1 : primaire", "2 : collège", "3 : lycée", "4 : sup"), type = "viridis")

dfPortugais$Fedu <- as.factor(dfPortugais$Fedu)
df <- dfPortugais %>% group_by(Fedu) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Fedu, mean_famrel)

dfFE <- ggplot(df, aes(x = Fedu, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Fedu)) +
    labs(title = "Relation familiales selon éducation de papa", x = "Education papa", y = "Relations familiales", fill = "Education papa") +
    scale_fill_discrete(labels = c("0 : Aucune", "1 : primaire", "2 : collège", "3 : lycée", "4 : sup"), type = "viridis")

grid.arrange(dfME, dfFE, ncol=2, nrow = 1)
```

Le niveau d'éducation du père importe peu pour les relations familiales. En revanche, pour la mère, il faut au moins qu'elle ait été en primaire. 

### Relations familiales selon la consomation d'alcool lors du week-end.
```{r Walc_famrel, echo=FALSE}
dfPortugais$Walc <- as.factor(dfPortugais$Walc)
df <- dfPortugais %>% group_by(Walc) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Walc, mean_famrel)

ggplot(df, aes(x = Walc, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Walc)) +
  labs(title = "Relations familiales Walc", x = "Walc", y = "Relation familiale", fill = "Walc") +
  scale_fill_discrete(type = "viridis")
```

On remarque que plus la consommation d'alcool est importante, moins les relations familiales sont bonnes.

# Conclusion sur l'élève qui a les meilleures relations familiales

# PARTIE SANTE



FIN PARTIE SANTE
---------------------------------------------------------------
