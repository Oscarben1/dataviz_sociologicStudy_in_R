---
title: "RmrkdwnGeneral"
author: "Oscar"
date: "23/04/2021"
output: html_document
---

Importons ici toutes les libraries utiles à notre projet
```{r message = FALSE}
library(readr)
library(ggplot2)
library(dplyr)
library(scales)
```


Importons dans un premier temps les datasets

```{r message = FALSE}
dfMathsComplet <- read_csv("data/student-mat.csv")
dfMaths <- dfMathsComplet %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfMaths %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfMaths <- cbind(dfMaths, temp) %>% rename('Gmean' = `rowSums(temp)/3`)

#Visualisation du dataset
head(dfMaths)

dfPortugaisComplet <- read_csv("data/student-por.csv")
dfPortugais <- dfPortugaisComplet %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfPortugais %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfPortugais <- cbind(dfPortugais, temp) %>% rename('Gmean' = `rowSums(temp)/3`)
head(dfPortugais)
```

INTERNET EN FONCTION DES NOTES 

```{r message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(internet) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(internet, mean_Gmean)

#Barplot 
ggplot(df, aes(x = internet, y = mean_Gmean)) + 
    geom_bar(stat = "identity") +
    scale_fill_brewer(palette = "Dark2") + 
    labs(x = "internet", y = "Gmean",title = "INTERNET EN FONCTION DES NOTES")
```

ADRESSE EN FONCTION DES NOTES

```{r message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(address) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(address, mean_Gmean)

#Barplot 
ggplot(df, aes(x = address, y = mean_Gmean)) + 
    geom_bar(stat = "identity") +
    scale_fill_brewer(palette = "Dark2") + 
    labs(x = "Adresse", y = "Gmean",title = "Adresse en fonction de la moyenne des notes")
```

FATHER ET MOTHER JOB EN FONCTION DES NOTES

```{r message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Fjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Fjob, mean_Gmean)

#Barplot 
ggplot(df, aes(x = Fjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity") +
    scale_fill_brewer(palette = "Dark2") + 
    labs(x = "Job du père", y = "Gmean",title = "Job du père en fonction de la moyenne des notes")
```

```{r message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Mjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Mjob, mean_Gmean)

#Barplot 
ggplot(df, aes(x = Mjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity") +
    scale_fill_brewer(palette = "Dark2") + 
    labs(x = "Adress", y = "Gmean",title = "Job de la mère en fonction de la moyenne des notes")
```

REPARTITION HOMME - FEMME DANS LES ECOLES

```{r message = FALSE}

ggplot(dfMaths, aes(x = school, fill = sex)) + 
  geom_bar(position = position_dodge(0.9), alpha = 0.6) + 
  scale_fill_brewer(palette = "Dark2") + 
  labs(fill = "Sexe", x = "Ecole", y = "Effectifs", title = "Part des effectifs Masculins et Féminins dans chaque école")
```

```{r}
tempsMoyenGarcons <- dfMaths %>% filter(sex == "M") %>% select(studytime) %>% mutate(mean_studytime = mean(studytime)) %>% distinct(mean_studytime)

tempsMoyenGarcons <- tempsMoyenGarcons[1,1]

tempsMoyenFilles <- dfMaths %>% filter(sex == "F") %>% select(studytime) %>% mutate(mean_studytime = mean(studytime)) %>% distinct(mean_studytime)

tempsMoyenFilles <- tempsMoyenFilles[1,1]
```

Voici le temps de travail en moyenne des garcons : `r tempsMoyenGarcons`

En comparaison au temps moyen des filles en Maths, qui est plus élevé : `r tempsMoyenFilles`


Regardons la MOYENNE selon le genre, en mathématiques --> garcon meilleurs en maths

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% select(sex, Gmean)

#BoxPlot
ggplot(df, aes(x = sex, y = Gmean)) + 
  geom_boxplot(aes(fill = sex),alpha = .6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  ggtitle("Répartition des notes en fonction du genre")
  
```

On regarde la repartition des ages --> On trie céar 20,21, 22 négligeable

```{r}
#preparation des donnees
df <- dfMathsComplet %>% select(age)

ggplot(df, aes(x = age)) +
  geom_bar(fill = "lightblue", alpha = 0.7) + 
  labs(title = "Repartiton des effectifs selon l'age", x = "age", y = "effectifs")
```

```{r message = FALSE}
dfPortugais$freetime <- as.factor(dfPortugais$freetime)
df <- dfPortugais %>% group_by(freetime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(freetime, mean_Gmean)

ggplot(df, aes(x = freetime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = freetime)) +
    geom_line(color = "blue") +
    labs(title = "Temps libre en fonction des notes", x = "temps libre", y = "moyenne des notes", fill = "Temps libre") +
    scale_fill_discrete(type = "viridis")
  
```

Voyons maintenant si le temps de travail implique des meilleurs notes, en Portugais :

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(studytime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(studytime, mean_Gmean)

ggplot(df, aes(x = studytime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = studytime)) +
    geom_line(color = "blue") +
    labs(title = "Notes en fonction du temps de travail en Portugais", x = "temps de travail", y = "moyenne des notes", fill = "Temps de travail") +
    scale_fill_continuous(labels = c("1 : très peu", "2 : modérément", "3 : suffisamment", "4 : beaucoup"), type = "viridis")
    

```

On voit que plus es élèves travaillent, meileures sont leurs notes, cependant, on voit que la différence n'est pas énorme (voire négligeable) entre 3h et 4h.


Conso d'alcool le wknd en fonction des notes --> boire un peu c'est bien

```{r message = FALSE}
df <- dfPortugais %>% group_by(Walc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Walc, mean_Gmean)

ggplot(df, aes(x = Walc, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Walc)) +
    geom_line(color = "blue") +
    labs(title = "Conso d'alcool le wknd en fonction des notes", x = "conso d'alcool le wknd", y = "moyenne des notes", fill = "conso d'alcool") +
    scale_fill_continuous(labels = c("1 : très peu", "2 : modérément", "3 : suffisamment", "4 : beaucoup", "5 : blablabla"), type = "viridis")
  
```

On peut voir que la consommation d'alcool a clairement un impact sur les notes et que ce sont ceux qui en consomment peu (niveau 2) qui ont les meilleures résultats. On peut donc considérer qu'il faut boire mais très peu, pour avoir les meilleurs notes (s'amuser le weekend pour relacher les cours par exemple).

Voyons maintenant si la consommation d'alcool la semaine a un gros impact : 

```{r message = FALSE}
df <- dfPortugais %>% group_by(Dalc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Dalc, mean_Gmean)

ggplot(df, aes(x = Dalc, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Dalc)) +
    geom_line(color = "blue") +
    labs(title = "Conso d'alcool en semaine en fonction des notes", x = "Conso d'alcool en semaine", y = "moyenne des notes", fill = "conso d'alcool") +
    scale_fill_continuous(labels = c("1 : très peu", "2 : modérément", "3 : suffisamment", "4 : beaucoup", "5 : blablabla"), type = "viridis")
```

L'impact de la consommation d'alcool en semaine semble encore plus lourd, cette fois si, le niveau 1 de consommation (pas de consommation) est celui qui obtient les meilleures notes.


Meme constat pour le portugais. On peut se dire que pour optimiser son temps, ne travailler que 3h et profiter de l'heure restant pour se détendre ou faire du sport est surement la bonne solution.

ABSENCES

```{r message = FALSE}
#preparation des données
df <- dfMaths

ggplot(df, aes(x = absences, y = Gmean)) +
    geom_point() +
    geom_smooth() +
    labs(title = "Notes en fonction du nb d'absences en maths", x = "absences", y = "moyenne des notes")

```

SOUHAIT DE FAIRE DES ETUDES SUP

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(higher) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(higher, mean_Gmean)

ggplot(df, aes(x = higher, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = higher)) +
    labs(title = "Notes en fonction de la volonté de faire des études sup en Maths", x = "volonté de faire des études sup", y = "moyenne des notes", fill = "volonté de faire des études sup")

```

SOUTIEN SCOLAIRE PAYANT (A mettre cote a cote avec soutien gratuit)

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(paid) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(paid, mean_Gmean)

ggplot(df, aes(x = paid, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = paid)) +
    labs(title = "Notes en fonction du soutien scolaire payant en Maths", x = "soutien scolaire payant", y = "moyenne des notes", fill = "Soutien scolaire payant")

```

SOUTIEN SCOLAIRE GRATUIT

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(schoolsup) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(schoolsup, mean_Gmean)

ggplot(df, aes(x = schoolsup, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = schoolsup)) +
    labs(title = "Notes en fonction du soutien scolaire en Maths", x = "soutien scolaire", y = "moyenne des notes", fill = "Soutien scolaire")

```

TRAVEL TIME 

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(traveltime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(traveltime, mean_Gmean)

ggplot(df, aes(x = traveltime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = traveltime)) +
    labs(title = "Notes en fonction du temps de trajet en Portugais", x = "traveltime", y = "moyenne des notes", fill = "traveltime") +
    scale_fill_continuous(labels = c("1 : court", "2 : passable", "3 : long", "4 : très long"), type = "viridis")

```

FAILURES

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(failures) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(failures, mean_Gmean)

ggplot(df, aes(x = failures, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = failures)) +
    labs(title = "Notes en fonction du temps de trajet en Portugais", x = "failures", y = "moyenne des notes", fill = "nb de failures")

```

