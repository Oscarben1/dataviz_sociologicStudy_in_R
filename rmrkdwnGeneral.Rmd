---
title: "RmrkdwnGeneral"
author: "Oscar"
date: "23/04/2021"
output: html_document
---

Importons ici toutes les libraries utiles à notre projet
```{r import packages, message = FALSE}
library(readr)
library(ggplot2)
library(dplyr)
library(scales)
library(gridExtra)
library("viridis")
```


Importons dans un premier temps les datasets

```{r import datasets et traitements, message = FALSE}
dfMathsComplet <- read_csv("data/student-mat.csv")
dfMaths <- dfMathsComplet %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfMaths %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfMaths <- cbind(dfMaths, temp) %>% rename('Gmean' = `rowSums(temp)/3`)

#Visualisation du dataset
head(dfMaths)

dfPortugaisComplet <- read_csv("data/student-por.csv")
dfPortugais <- dfPortugaisComplet %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfPortugais %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfPortugais <- cbind(dfPortugais, temp) %>% rename('Gmean' = `rowSums(temp)/3`)
head(dfPortugais)
```

INTERNET EN FONCTION DES NOTES 


```{r internet, message = FALSE}

notesSiInternet <- dfMaths %>% filter(internet == "yes") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiInternet <- notesSiInternet[1,1]

notesSiPasInternet <- dfMaths %>% filter(internet == "no") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiPasInternet <- notesSiPasInternet[1,1]
```

Voici la moyenne des notes des élèves ayant internet : `r notesSiInternet` qui est bien plus élevé que la moyenne des notes des élèves n'ayant pas internet : `r notesSiPasInternet`. L'importance d'avoir internet pour les études est bien visible ici.

ADRESSE EN FONCTION DES NOTES

```{r address, message = FALSE}
notesSiVille <- dfPortugais %>% filter(address == "U") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiVille <- notesSiVille[1,1]

notesSiCampagne <- dfPortugais %>% filter(address == "R") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiCampagne <- notesSiCampagne[1,1]
```

On peut avoir accès également à la moyenne des notes des élèves venant de la ville : `r notesSiVille` et celle de ceux venant de la campagne : `r notesSiCampagne`. On peut voir qu'en général, les personnes venant de la ville réussissent mieux que celles venant de la campagne. On peut se dire que le temps de trajet joue un grand rôle dans la réussite des élèves, et nous allons le vérifier.

TRAVEL TIME 

```{r traveltime, message = FALSE}
dfPortugais$traveltime <- as.factor(dfPortugais$traveltime)
#preparation des données
df <- dfPortugais %>% group_by(traveltime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(traveltime, mean_Gmean)

ggplot(df, aes(x = traveltime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = traveltime)) +
    labs(title = "Notes en fonction du temps de trajet en Portugais", x = "traveltime", y = "moyenne des notes", fill = "traveltime") +
    scale_fill_discrete(type = "viridis")

```

En effet, les notes baissent plus le temps de trajet est long. Cela concore bien avec les résultats trouvés précédemment.

FATHER ET MOTHER JOB EN FONCTION DES NOTES

```{r fjob, message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Fjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Fjob, mean_Gmean)

#Barplot 
fJob <- ggplot(df, aes(x = Fjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity", fill = viridis(5), alpha = .7) +
    labs(x = "Job du père", y = "Gmean",title = "Moyenne selon le Job du père")
```

```{r mjob, message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Mjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Mjob, mean_Gmean)

#Barplot 
mJob <- ggplot(df, aes(x = Mjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity", fill = viridis(5), alpha = .7) +
    labs(x = "Job de la mère", y = "Gmean",title = "Moyenne selon le Job de la mère")

grid.arrange(fJob, mJob, ncol=2, nrow = 1)
```

REPARTITION HOMME - FEMME DANS LES ECOLES

```{r repHommeFemme, message = FALSE}

ggplot(dfMaths, aes(x = school, fill = sex)) + 
  geom_bar(position = position_dodge(0.9), alpha = 0.6, fill = viridis(2)) + 
  labs(fill = "Sexe", x = "Ecole", y = "Effectifs", title = "Part des effectifs Masculins et Féminins dans chaque école")
```

```{r studytime garcons filles}
tempsMoyenGarcons <- dfMaths %>% filter(sex == "M") %>% select(studytime) %>% mutate(mean_studytime = mean(studytime)) %>% distinct(mean_studytime)

tempsMoyenGarcons <- tempsMoyenGarcons[1,1]

tempsMoyenFilles <- dfMaths %>% filter(sex == "F") %>% select(studytime) %>% mutate(mean_studytime = mean(studytime)) %>% distinct(mean_studytime)

tempsMoyenFilles <- tempsMoyenFilles[1,1]
```

Voici le temps de travail en moyenne des garcons : `r tempsMoyenGarcons`

En comparaison au temps moyen des filles en Maths, qui est plus élevé : `r tempsMoyenFilles`


Regardons la MOYENNE selon le genre, en mathématiques --> garcon meilleurs en maths

```{r notes selon sexe, message = FALSE}
#preparation des données
df <- dfMaths %>% select(sex, Gmean)

#BoxPlot
ggplot(df, aes(x = sex, y = Gmean)) + 
  geom_boxplot(aes(fill = sex),alpha = .8,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Pastel2") +
  ggtitle("Répartition des notes en fonction du genre")
  
```

On regarde la repartition des ages --> On trie céar 20,21, 22 négligeable

```{r repartition des ages}
#preparation des donnees
df <- dfMathsComplet %>% select(age)

ggplot(df, aes(x = age)) +
  geom_bar(alpha = 0.7, fill = viridis(8)) + 
  labs(title = "Repartiton des effectifs selon l'age", x = "age", y = "effectifs")

```

```{r freetime, message = FALSE}
dfPortugais$freetime <- as.factor(dfPortugais$freetime)
df <- dfPortugais %>% group_by(freetime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(freetime, mean_Gmean)

ggplot(df, aes(x = freetime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = freetime)) +
    geom_line(color = "blue") +
    labs(title = "Temps libre en fonction des notes", x = "temps libre", y = "moyenne des notes", fill = "Temps libre") +
    scale_fill_discrete(type = "viridis")
  
```

Voyons maintenant si le temps de travail implique des meilleurs notes, en Portugais :

```{r studytime, message = FALSE}
dfPortugais$studytime <- as.factor(dfPortugais$studytime)
#preparation des données
df <- dfPortugais %>% group_by(studytime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(studytime, mean_Gmean)

ggplot(df, aes(x = studytime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = studytime)) +
    geom_line(color = "blue") +
    labs(title = "Notes en fonction du temps de travail en Portugais", x = "temps de travail", y = "moyenne des notes", fill = "Temps de travail") +
    scale_fill_discrete(type = "viridis")
    

```

On voit que plus es élèves travaillent, meileures sont leurs notes, cependant, on voit que la différence n'est pas énorme (voire négligeable) entre 3h et 4h.


Conso d'alcool le wknd en fonction des notes --> boire un peu c'est bien

```{r alcool le wknd, message = FALSE}
dfPortugais$Walc <- as.factor(dfPortugais$Walc)
df <- dfPortugais %>% group_by(Walc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Walc, mean_Gmean)

Walc <- ggplot(df, aes(x = Walc, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Walc)) +
    geom_line(color = "blue") +
    labs(title = "Conso d'alcool le wknd en fonction des notes", x = "conso d'alcool le wknd", y = "moyenne des notes", fill = "conso d'alcool") +
    scale_fill_discrete(type = "viridis")
  
```

On peut voir que la consommation d'alcool a clairement un impact sur les notes et que ce sont ceux qui en consomment peu (niveau 2) qui ont les meilleures résultats. On peut donc considérer qu'il faut boire mais très peu, pour avoir les meilleurs notes (s'amuser le weekend pour relacher les cours par exemple).

Voyons maintenant si la consommation d'alcool la semaine a un gros impact : 

```{r alcool la semaine, message = FALSE}
dfPortugais$Dalc <- as.factor(dfPortugais$Dalc)
df <- dfPortugais %>% group_by(Dalc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Dalc, mean_Gmean)

Dalc <- ggplot(df, aes(x = Dalc, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Dalc)) +
    geom_line(color = "blue") +
    labs(title = "Notes selon la conso d'alcool en semaine", x = "Conso d'alcool en semaine", y = "moyenne des notes", fill = "conso d'alcool") +
    scale_fill_discrete(type = "viridis")
grid.arrange(Walc, Dalc, ncol=2, nrow = 1)

```

L'impact de la consommation d'alcool en semaine semble encore plus lourd, cette fois si, le niveau 1 de consommation (pas de consommation) est celui qui obtient les meilleures notes.


Meme constat pour le portugais. On peut se dire que pour optimiser son temps, ne travailler que 3h et profiter de l'heure restant pour se détendre ou faire du sport est surement la bonne solution.

ABSENCES

```{r absences, message = FALSE}
#preparation des données
df <- dfMaths

ggplot(df, aes(x = absences, y = Gmean)) +
    geom_point() +
    geom_smooth() +
    labs(title = "Notes en fonction du nb d'absences en maths", x = "absences", y = "moyenne des notes")

```

SOUHAIT DE FAIRE DES ETUDES SUP

```{r etudes sup, message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(higher) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(higher, mean_Gmean)

ggplot(df, aes(x = higher, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.8, aes(fill = higher)) +
    labs(title = "Notes en fonction de la volonté de faire des études sup en Maths", x = "volonté de faire des études sup", y = "moyenne des notes", fill = "volonté de faire des études sup") +
  scale_fill_brewer(palette = "Pastel2")

```

SOUTIEN SCOLAIRE PAYANT (A mettre cote a cote avec soutien gratuit)

```{r paid soutien scolaire, message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(paid) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(paid, mean_Gmean)

paid <- ggplot(df, aes(x = paid, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = paid)) +
    labs(title = "Notes selon soutien payant en Maths", x = "soutien scolaire payant", y = "moyenne des notes", fill = "élève soutenu") +
    scale_fill_brewer(palette = "Pastel2")

```

SOUTIEN SCOLAIRE GRATUIT

```{r soutien scolaire gratuit, message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(schoolsup) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(schoolsup, mean_Gmean)

schoolsup <- ggplot(df, aes(x = schoolsup, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = schoolsup)) +
    labs(title = "Notes selon soutien gratuit en Maths", x = "soutien scolaire gratuit", y = "moyenne des notes", fill = "élève soutenu") +
    scale_fill_brewer(palette = "Pastel2")

grid.arrange(schoolsup, paid, ncol=2, nrow = 1)

```

FAILURES

```{r echecs, message = FALSE}
dfPortugais$failures <- as.factor(dfPortugais$failures)
#preparation des données
df <- dfPortugais %>% group_by(failures) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(failures, mean_Gmean)

ggplot(df, aes(x = failures, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = failures)) +
    labs(title = "Notes en fonction du temps de trajet en Portugais", x = "failures", y = "moyenne des notes", fill = "nb de failures") +
    scale_fill_discrete(type = "viridis")

```

