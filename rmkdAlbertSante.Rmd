---
title: "rmkdAlbertSante"
author: "Albert ELOMBO"
date: "19/05/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

Dans cette paertie du projet on va s'interesser à la santé des élèves. Dans un premier temps à la santé physique, puis à la santé mentale.
Considérant que le dataset nous donne des informations sur contexte social, économique et culturel des famlles ainsi que sur le sexe, nous allons essayer de trouver des correlations entre l'état de santé des élèves ainsi que ces critères.

#Exploration du dataset

## Variables à priori signifiatives sur la santé

* Pstatus, guardian, studytime, freetime, goout, Dalc, Walc romantic pour la santé mentale
* Medu, Fedu, Mjob, Fjob, Famrel pour le contexte
* Health comme indicateur de significativité

## Santé exploration


```{r}
# On charge les libraries

library(dplyr)
library(ggplot2)

#On charge les datasets
dfMat <- as_tibble(read.csv("data/student-mat.csv"))
dfPor <- as_tibble(read.csv("data/student-por.csv"))

```


### Etat de santé général
Distribution de l'état de santé
```{r}
plotMat <- ggplot(dfMat, aes( x = health, fill = sex)) + 
  geom_bar() + 
  labs(title = "répartition de l'état de santé", x = "état de santé", y = "effectif")

plotPor <- ggplot(dfPor, aes( x = health, fill = sex)) + 
  geom_bar() +
  labs(title = "répartition de l'état de santé", x = "état de santé", y = "effectif")
        

plotMat
plotPor
```

Etat de santé en fonction de la relation familiale

```{r}
dataMat <- dfMat %>% select(health, famrel)

dataMat <- dataMat %>% group_by(famrel) %>% summarise_all(mean)

plotMat <- dataMat %>% ggplot( aes(x = famrel, y = health)) +
  geom_col(aes( fill = famrel)) + 
  labs( title = "État de santé en fonction de la relation familliale",
        x = "Relation familiale", y = "État de santé / 5")

dataPor <- dfMat %>% select(health, famrel)

dataPor <- dataMat %>% group_by(famrel) %>% summarise_all(mean)

plotPor <- dataMat %>% ggplot( aes(x = famrel, y = health)) +
  geom_col(aes( fill = famrel)) +
  labs( title = "État de santé en fonction de la relation familliale",
        x = "Relation familiale", y = "État de santé / 5") 
plotMat
plotPor
```

Relation familiale en fonction du sexe

```{r}
dataMat <- dfMat %>% select(sex, famrel) %>%
  group_by(sex) %>%
  summarise_all(mean)

head(dataMat)

plotMat <- ggplot(dataMat, aes(x = sex, y = famrel)) +
  geom_col(aes(fill = famrel)) + 
  labs( title = "Relation familiale moyenne selon le sexe", x = "sexe", y = "relation familiale")

plotMat
```

Etat de santé en fonction du sexe

```{r}
dataMat <- dfMat %>% select(sex, health) %>%
  group_by(sex) %>%
  summarise_all(mean)

head(dataMat)

plotMat <- ggplot(dataMat, aes(x = sex, y = health)) +
  geom_col(aes(fill = health)) + 
  labs( title = "Relation familiale moyenne selon le sexe", x = "sexe", y = "relation familiale")

plotMat
```




Etat de santé en fonction de la consommation d'alcool

* En week-end

```{r}
library(tidyverse)
dataMat <- dfMat %>% select(health, Walc, sex)

dataMat1 <- dataMat %>% filter(sex == "M") %>%
  select(health, Walc)%>%
  group_by(Walc) %>% summarise_at(vars(health), funs(mean)) %>%
  add_column(sex = "M")

dataMat2 <- dataMat %>% filter(sex == "F") %>%
  select(health, Walc)%>%
  group_by(Walc) %>% summarise_at(vars(health), funs(mean)) %>%
  add_column(sex = "F")


dataMat <- bind_rows(dataMat1, dataMat2)

plotMat <- dataMat %>% ggplot( aes(x = Walc, y = health)) +
  geom_col(aes(fill = sex), position = "dodge") + 
  labs( title = "État de santé en fonction de la consomation d'alcool le week-end",
        x = "consomation d'alcool / 5", y = "État de santé / 5")

plotMat
```

* En semaine
```{r}
dataMat <- dfMat %>% select(health, Dalc)

dataMat <- dataMat %>% group_by(Dalc) %>% summarise_all(mean)

plotMat <- dataMat %>% ggplot( aes(x = Dalc, y = health)) +
  geom_col(aes()) + 
  labs( title = "État de santé en fonction de la consomation d'alcool le week-end",
        x = "consomation d'alcool / 5", y = "État de santé / 5")

plotMat
```

* La moyenne des deux



```{r}
dataMat <- dfMat %>% transmute(health, alc = (Dalc + Walc)/2)
dataMat <- dataMat %>% group_by(alc) %>% summarise_all(mean)
head (dataMat)

plotMat <- dataMat %>% ggplot( aes(x = factor (alc), y = health)) +
  geom_col(aes( fill = health)) + 
  labs( title = "État de santé en fonction de la consomation d'alcool en général",
        x = "consomation d'alcool / 5", y = "État de santé / 5")

plotMat
```

Consomation d'alcool en fonction du sexe

```{r}
dataMat <- dfMat %>% transmute(sex, alc = (Dalc + Walc)/2)
dataMat <- dataMat %>% group_by(sex) %>% summarise_all(mean)
head (dataMat)

plotMat <- dataMat %>% ggplot( aes(x = sex, y = alc)) +
  geom_col(aes( fill = sex)) +
  labs( title = "consommation moyenne d'alcool selon le sexe ", x = "sexe", y = "consommation d'alcool")

plotMat
```

Répartition de la consommation d'alcool 

* En moyenne

```{r}
dataMat <- dfMat %>%
  transmute(sex, alc = (Dalc + Walc)/2)


plotMat <- ggplot(dataMat, aes(x  = factor(alc), fill = sex)) + 
  geom_bar(position = "dodge") 

plotMat
```

* En week-end

```{r}
dataMat <- dfMat %>% select(sex, Walc)

plotMat <- ggplot(dataMat, aes(x  = factor(Walc), fill = sex)) + 
  geom_bar(position = "dodge") 

plotMat
```


* En semaine

```{r}
dataMat <- dfMat %>% select(sex, Dalc)

plotMat <- ggplot(dataMat, aes(x  = factor(Dalc), fill = sex)) + 
  geom_bar(position = "dodge") 

plotMat
```


Etat de santé en fonction de la vie amoureuse

```{r}
dataMat <- dfMat %>% select(health, romantic)

dataMat <- dataMat %>% group_by(romantic) %>% summarise_all(mean)

plotMat <- dataMat %>% ggplot( aes(x = factor(romantic), y = health)) +
  geom_col(aes( fill = romantic)) + 
  labs( title = "État de santé en fonction de la vie amoureuse",
        x = "En couple", y = "État de santé / 5")

plotMat
```

Etat de santé en fonction du tuteur

```{r}
dataMat <- dfMat %>% select(guardian, health) %>%
  group_by(guardian) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes(x = factor(guardian), y = health, fill = guardian )) + 
  geom_col() +
  labs( title = "Etat de santé en fonction du tuteur")

plotMat
```
Etat de santé en fonction de la nature de la famille.

```{r}
dataMat <- dfMat %>% select(Pstatus, health) %>%
  group_by(Pstatus) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes(x = factor(Pstatus), y = health, fill = Pstatus )) + 
  geom_col() +
  labs( title = "Etat de santé en fonction du tuteur")

plotMat
```





Etat de santé en fonction du tuteur pour les familles séparées

```{r}
dataMat <- dfMat %>% filter(Pstatus == 'A') %>%
  select(guardian, health) %>%
  group_by(guardian) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes(x = factor(guardian), y = health, fill = guardian )) + 
  geom_col() +
  labs( title = "Etat de santé en fonction du tuteur pour les familles séparées")

plotMat
```

Etat de santé en fonction du tuteur chez les familles non séparées

```{r}
dataMat <- dfMat %>% filter(Pstatus == 'T') %>%
  select(guardian, health) %>%
  group_by(guardian) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes(x = factor(guardian), y = health, fill = guardian )) + 
  geom_col() +
  labs( title = "Etat de santé en fonction du tuteur pour les familles ensembles")

plotMat
```
 
### Etat de santé en fonction dela situation des parents

Travail de la mère

```{r}
dataMat <- dfMat %>% select(Mjob, health) %>%
  group_by(Mjob) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Mjob, y = health, fill = Mjob)) +
  geom_col() + 
  labs(title = "Etat de santé en fonction du travail de la mère")

plotMat

```

Travail du père

```{r}
dataMat <- dfMat %>% select(Fjob, health) %>%
  group_by(Fjob) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Fjob, y = health, fill = Fjob)) +
  geom_col() + 
  labs(title = "Etat de santé en fonction du travail du père")

plotMat
```

Essayons d'effectuer l'étude avec les doublets de couples

```{r}
library(tidyr)
dataMat <- dfMat %>% select(Fjob, Mjob, health) %>%
  unite("Pjob",c(Mjob, Fjob), sep = "\n", remove = TRUE) %>%
  group_by(Pjob) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Pjob, y = health)) +
  geom_col() + 
  labs(title = "Etat de santé en fonction du travail des parents")

plotMat

# portuguais

dataPor <- dfPor %>% select(Fjob, Mjob, health) %>%
  unite("Pjob",c(Mjob, Fjob), sep = "\n", remove = TRUE) %>%
  group_by(Pjob) %>%
  summarise_all(mean)

plotPor <- ggplot(dataPor, aes( x = Pjob, y = health)) +
  geom_col() + 
  labs(title = "Etat de santé en fonction du travail des parents")

plotPor
```

observons l'effectif pour le cas minimal

```{r}
dataMat <- dataMat <- dfMat %>% select(Fjob, Mjob, health) %>%
  unite("Pjob",c(Mjob, Fjob) , sep = "\n", remove = TRUE) %>%
  count(Pjob)

dataMat

dataPor <- dataPor <- dfPor %>% select(Fjob, Mjob, health) %>%
  unite("Pjob",c(Mjob, Fjob) , sep = "\n", remove = TRUE) %>%
  count(Pjob)

dataPor

```

Education de la mère

```{r}
dataMat <- dfMat %>% select(Medu, health) %>%
  group_by(Medu) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Medu, y = health, fill = Medu)) +
  geom_col() + 
  labs(title = "Etat de santé en fonction de l'éducation de la mère")

plotMat
```

Education du père

```{r}
dataMat <- dfMat %>% select(Fedu, health) %>%
  group_by(Fedu) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Fedu, y = health, fill = Fedu)) +
  geom_col() + 
  labs(title = "Etat de santé en fonction de l'éducation du père")

plotMat
```

Les couples

```{r}
dataMat <- dfMat %>% select(Fedu, Medu, health) %>%
  unite("Pedu",c(Medu, Fedu), sep = "\n", remove = TRUE) %>%
  group_by(Pedu) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Pedu, y = health)) +
  geom_col() + 
  labs(title = "Etat de santé en fonction de l'éducation des parents")

plotMat

# portuguais

dataPor <- dfPor %>% select(Fedu, Medu, health) %>%
  unite("Pedu",c(Medu, Fedu), sep = "\n", remove = TRUE) %>%
  group_by(Pedu) %>%
  summarise_all(mean)

plotPor <- ggplot(dataPor, aes( x = Pedu, y = health)) +
  geom_col() + 
  labs(title = "Etat de santé en fonction de l'éducation des parents")

plotPor
```

effectifs

```{r}
dataMat <- dataMat <- dfMat %>% select(Fedu, Medu, health) %>%
  unite("Pedu",c(Medu, Fedu) , sep = "\n", remove = TRUE) %>%
  count(Pedu)

dataMat

dataPor <- dataPor <- dfPor %>% select(Fedu, Medu, health) %>%
  unite("Pedu",c(Medu, Fedu) , sep = "\n", remove = TRUE) %>%
  count(Pedu)

dataPor
```
#######################################################################################################
## Exploration relation de famille


relation familliale en fonction du tuteur

```{r}
dataMat <- dfMat %>% select(guardian, famrel) %>%
  group_by(guardian) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes(x = factor(guardian), y = famrel, fill = guardian )) + 
  geom_col() +
  labs( title = "relation familliale en fonction du tuteur")

plotMat
```

relation familliale en fonction du tuteur pour les familles séparées

```{r}
dataMat <- dfMat %>% filter(Pstatus == 'A') %>%
  select(guardian, famrel) %>%
  group_by(guardian) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes(x = factor(guardian), y = famrel, fill = guardian )) + 
  geom_col() +
  labs( title = "relation familliale en fonction du tuteur pour les familles séparées")

plotMat
```

relation familliale en fonction du tuteur chez les familles non séparées

```{r}
dataMat <- dfMat %>% filter(Pstatus == 'T') %>%
  select(guardian, famrel) %>%
  group_by(guardian) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes(x = factor(guardian), y = famrel, fill = guardian )) + 
  geom_col() +
  labs( title = "relation familliale en fonction du tuteur pour les familles ensembles")

plotMat
```
 
### relation familliale en fonction dela situation des parents

Travail de la mère

```{r}
dataMat <- dfMat %>% select(Mjob, famrel) %>%
  group_by(Mjob) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Mjob, y = famrel, fill = Mjob)) +
  geom_col() + 
  labs(title = "relation familliale en fonction du travail de la mère")

plotMat

```

Travail du père

```{r}
dataMat <- dfMat %>% select(Fjob, famrel) %>%
  group_by(Fjob) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Fjob, y = famrel, fill = Fjob)) +
  geom_col() + 
  labs(title = "relation familliale en fonction du travail du père")

plotMat
```

Essayons d'effectuer l'étude avec les doublets de couples

```{r}
library(tidyr)
dataMat <- dfMat %>% select(Fjob, Mjob, famrel) %>%
  unite("Pjob",c(Mjob, Fjob), sep = "\n", remove = TRUE) %>%
  group_by(Pjob) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Pjob, y = famrel)) +
  geom_col() + 
  labs(title = "relation familliale en fonction du travail des parents")

plotMat

# portuguais

dataPor <- dfPor %>% select(Fjob, Mjob, famrel) %>%
  unite("Pjob",c(Mjob, Fjob), sep = "\n", remove = TRUE) %>%
  group_by(Pjob) %>%
  summarise_all(mean)

plotPor <- ggplot(dataPor, aes( x = Pjob, y = famrel)) +
  geom_col() + 
  labs(title = "relation familliale en fonction du travail des parents")

plotPor
```

observons l'effectif pour le cas minimal

```{r}
dataMat <- dataMat <- dfMat %>% select(Fjob, Mjob, famrel) %>%
  unite("Pjob",c(Mjob, Fjob) , sep = "\n", remove = TRUE) %>%
  count(Pjob)

dataMat

dataPor <- dataPor <- dfPor %>% select(Fjob, Mjob, famrel) %>%
  unite("Pjob",c(Mjob, Fjob) , sep = "\n", remove = TRUE) %>%
  count(Pjob)

dataPor

```

Education de la mère

```{r}
dataMat <- dfMat %>% select(Medu, famrel) %>%
  group_by(Medu) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Medu, y = famrel, fill = Medu)) +
  geom_col() + 
  labs(title = "relation familliale en fonction de l'éducation de la mère")

plotMat
```

Education du père

```{r}
dataMat <- dfMat %>% select(Fedu, famrel) %>%
  group_by(Fedu) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Fedu, y = famrel, fill = Fedu)) +
  geom_col() + 
  labs(title = "relation familliale en fonction de l'éducation du père")

plotMat
```

Les couples

```{r}
dataMat <- dfMat %>% select(Fedu, Medu, famrel) %>%
  unite("Pedu",c(Medu, Fedu), sep = "\n", remove = TRUE) %>%
  group_by(Pedu) %>%
  summarise_all(mean)

plotMat <- ggplot(dataMat, aes( x = Pedu, y = famrel)) +
  geom_col() + 
  labs(title = "relation familliale en fonction de l'éducation des parents")

plotMat

# portuguais

dataPor <- dfPor %>% select(Fedu, Medu, famrel) %>%
  unite("Pedu",c(Medu, Fedu), sep = "\n", remove = TRUE) %>%
  group_by(Pedu) %>%
  summarise_all(mean)

plotPor <- ggplot(dataPor, aes( x = Pedu, y = famrel)) +
  geom_col() + 
  labs(title = "relation familliale en fonction de l'éducation des parents")

plotPor
```

effectifs

```{r}
dataMat <- dataMat <- dfMat %>% select(Fedu, Medu, famrel) %>%
  unite("Pedu",c(Medu, Fedu) , sep = "\n", remove = TRUE) %>%
  count(Pedu)

dataMat

dataPor <- dataPor <- dfPor %>% select(Fedu, Medu, famrel) %>%
  unite("Pedu",c(Medu, Fedu) , sep = "\n", remove = TRUE) %>%
  count(Pedu)

dataPor
```