---
title: "Rapport de projet, IF36"
author: "Oscar BENOIT - Clément MALIDOR - Albert ELOMBO"
output: 
  html_document:
    theme: journal
    toc: true
    toc_float: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Introduction

Ce document Rmarkdown fait office de rapport final au projet d'IF36. En effet, le but étant de choisir un jeu de données existant afin de réaliser une analyse sur ce dernier à l'aide de data visualisation.

### Notre DataSet

Nous avons choisi d’utiliser **deux datasets** portant sur **la prédiction des résultats finaux de lycéens** de **deux établissements portugais** : **Gabriel Perreira** et **Mousinho da Silveira**. Les résultats visibles dans les datasets concernent les **mathématiques** et le **portugais** et ce dernier a été conçu de telle sorte qu’on puisse connaître le niveau (la note) de chaque élève dans les deux matières.<br>
Notre dataset contient **33 variables** avec **395 observations** pour les dataset avec les notes en mathématiques et **649 observations** pour les dataset avec les notes en portugais. Parmi les variables, on dénote **16 entiers**, **9 chaînes** et **8 booléennes**. Les entiers permettent parfois de donner des échelles chiffrées pour évaluer des situations (consommation alcool, éducation des parents, relations familiales, niveau de santé…).<br>
Nous disposons donc à priori d’assez de données pour avoir un résultat significatif. <br>
De façon générale, les variables nous donnent des informations sur **l’environnement socio-culturel** de l’élève à travers le milieu dans lequel il réside, **les activités** auxquelles il a accès et **le background académique** dont disposent ses parents. Nous retrouvons aussi des données relatives à **la charge de travail** de ces derniers ainsi que de **leur état de santé**.

### Nos graphiques

Notre analyse portera sur **3 différents axes**. Dans un premier temps, l'axe principal de notre réflexion sera **l'analyse des notes** en fonction de différents critères, de différentes variables, qui nous semblaient plus intéressantes à l'analyse. Le but étant de trouver le profil "type" de **l'élève modèle** (avec les meilleurs résultats).<br>
Puis, un deuxième axe de réflexion portera sur **les relations familiales** des élèves, en analysant quelles sont les variables qui expliquent le mieux **les bonnes relations familiales** d'un élève.<br>
Enfin, nous avons choisi de travailler sur **le plan santé**, qu'est-ce qui permet à un étudiant d'avoir **la meilleure santé possible**. Notre analyse comporte une trentaine de graphes, ce qui est assez long mais nous avons jugé chaque graph présent comme **indispensable à la bonne compréhension** des axes de développement, afin que l'analyse soit la plus **claire** et **précise** possible.

<!--  Importations des libraries -->

```{r import packages, message = FALSE}
library(readr)
library(ggplot2)
library(dplyr)
library(scales)
library(gridExtra)
library(tidyverse)
library("viridis")
library(treemapify)
library(corrplot)
```

### Exploration des données

La première partie de notre projet a consisté en l'exploration de nos jeux de données. En effet, les individus n'étant **pas les mêmes** sur le dataset **mathématiques** et le dataset **portugais**, il nous était impossible de les regrouper. Cependant, nous avons tout de même choisi de garder les deux en réalisant nos graph sur le dataset que nous avons jugé le plus approprié selon les variables analysées. <br>
En effet, le dataset portugais comporte **plus d'individus** que le dataset mathématiques, donc lorsque nous avons réalisé les graphes avec ce dernier c'est que nous voulions **une bonne représentativité des individus**. Au contraire, nous avons jugé que le dataset mathématiques nous était utile lorsque **le sérieux des élèves** primait sur le nombre d'élèves, car nous considérions que **les mathématiques étaient une matière plus importante que le portugais** et donc que les élèves étaient plus sérieux dans cette matière.

### Explications des échelles numériques + données

En amont de l'analyse, nous allons commencer par expliquer certaines variables, qui peuvent parraître implicites pour certains. En effet, certaines de ces varaibles sont des échelles quantifiées, d'autres sont des initiales qui représentent des mots.<br>
**Explication des échelles quantifiées :**
<ul>
  <li>Medu, Fedu (niveau d'étude de la mère et du père) : échelle allant de 0 à 4 : 0 : **aucune**, 1 : **primaire**, 2 : **collège**, 3 : **lycée**, 4 : **supérieur**</li>
  <li>traveltime (temps de trajet entre la maison et l'école) : échelle allant de 1 à 4 : 1 : **0 - 15 min**, 2 : **15 - 30 min**, 3 : **30 - 60 min**, 4 : **> 1 heure**</li>
  <li>studytime (temps de travail) : échelle allant de 1 à 4 : 1 : **0 - 2 h**, 2 : **2 - 5 h**, 3 : **5 - 10 h**, 4 : **> 10 heures**</li>
  <li>famrel (relations familiales), health (niveau de santé) : échelle allant de 1 à 5 : 1 : **vraiment mauvais**, 5 : **excellent**</li>
  <li>freetime (temps libre), goout (temps de sortie avec les amis), Dalc et Walc (consommation d'alcool la semaine et le week-end): échelle allant de 1 à 5 : 1 : **vraiment peu**, 5 : **vraiment beaucoup**</li>
</ul><br>
**Explication des initiales et accronymes :**
<ul>
  <li>school (école) : GP : **Gabriel Perreira**, MS : **Mousinho da Silveira**</li>
  <li>sex (sexe de l'élève) : M : **Garçon**, F : **Fille**</li>
  <li>address (lieu de vie) : R : **Campagne**, U : **Ville**</li>
  <li>famsize (taille de la famille) : LE3 : **3 personnes ou moins**, GT3 : **Plus de 3 personnes**</li>
  <li>Pstatus (statut marital des parents) : A : **parents séparés**, T : **parents ensembles**</li>
</ul><br>

### Importation des dataset et datacleaning

Importons dans un premier temps les datasets. Lors de notre exploration de données, nous avons pu déceler **deux problèmes** qu'il fallait résoudre : le premier étant le fait que **la population de 20 ans et + était clairement négligeable** dans les datasets et nous avons donc décidé de l'enlever pour pouvoir avoir une vision plus claire sur les 15 - 19 ans (âges lycéens). 

```{r repartition des ages, message = FALSE}
dfMathsComplet <- read_csv("data/student-mat.csv")
#preparation des donnees
df <- dfMathsComplet %>% select(age)

ggplot(df, aes(x = age)) +
  geom_bar(alpha = 0.7, fill = viridis(8)) + 
  labs(title = "Repartiton des effectifs selon l'âge", x = "Âge", y = "Effectifs")

```

Le deuxième problème était **l'absence d'une moyenne générale** des élèves. En effet, la régularité des notes étant un critère à prendre en compte dans nos analyses. Nous avons donc décidé de **créer cette nouvelle variable "Gmean"** qui est **la moyenne des notes des élèves sur les toris trimestres**. Ce sera cette variable sur laquelle nous nous baserons pour réaliser nos analyses des notes.  

```{r import datasets et traitements, message = FALSE}
dfMaths <- dfMathsComplet %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfMaths %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfMaths <- cbind(dfMaths, temp) %>% rename('Gmean' = `rowSums(temp)/3`)

dfPortugais <- read_csv("data/student-por.csv") %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfPortugais %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfPortugais <- cbind(dfPortugais, temp) %>% rename('Gmean' = `rowSums(temp)/3`)

dfPortugais %>%
  select(G1, G2, G3, Gmean) %>%
  head()
```

### Graphique de corrélationn

Afin d'avoir un premier aperçu lors de l'exploration de nos données, nous avons réalisé un graphe de corrélation des variables numériques de notre dataset. Cela nous a permis de voir que certaines variables étaient très corrélées, positivement ou négativement.<br>
Voici ce diagramme :

```{r correlation, message = FALSE}

df <- dfMaths %>% select(age, Medu, Fedu,traveltime, studytime, failures, famrel,freetime,Dalc,Walc,health,absences,Gmean)

mcor <- cor(df)
corrplot(mcor, type="upper", order="hclust", tl.col="black", tl.srt=90) 

```

# Comment être l'élève avec les meilleurs résultats ?

Dans cette première partie, nous allons essayer de trouver **quels sont les critères qui permettent de définir le profil type de "l'élève-modèle"**.

### Qui travaille le plus ? Et à quel prix ?

Souvent il y a une compéition entre les filles et les garçons à l'école, et on entend souvent dire que **les filles sont meilleures que les garçons. Mais est-ce la vérité ?**

```{r studytime_sex_grade, message = FALSE}
tempsMoyenGarcons <- dfMaths %>% filter(sex == "M") %>% select(studytime) %>% mutate(mean_studytime = mean(studytime)) %>% distinct(mean_studytime)

tempsMoyenGarcons <- tempsMoyenGarcons[1,1]

tempsMoyenFilles <- dfMaths %>% filter(sex == "F") %>% select(studytime) %>% mutate(mean_studytime = mean(studytime)) %>% distinct(mean_studytime)

tempsMoyenFilles <- tempsMoyenFilles[1,1]
```

Voici le temps de travail en moyenne des garcons : **`r round(tempsMoyenGarcons, digits=2)`**. <br>

En comparaison au temps moyen des filles en Maths, qui est plus élevé : **`r round(tempsMoyenFilles, digits=2)`**.<br>

Regardons les notes en mathématiques selon le genre à l'aide d'un boxplot afin d'avoir plus de précision sur les différents quartiles. En y ajoutant un point blanc dans les boxplot qui symbolise la moyenne des notes.

```{r sex_grade, message = FALSE}
#preparation des données
df <- dfMaths %>% select(sex, Gmean)

#BoxPlot
ggplot(df, aes(x = sex, y = Gmean)) + 
  geom_boxplot(aes(fill = sex),alpha = .8,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Pastel2") +
  labs(title = "Moyenne en fonction du sexe", x = "Sexe", y = "Moyenne des notes") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Filles","Garçons"))
  
```

On peut donc voir que **les garcons ont des meilleures notes que les filles**, alors qu'ils travaillent moins en moyenne. On peut donc en conclure que les **filles sont plus studieuses que les garçons**, mais que cela ne se fait pas ressentir au niveau des notes et donc qu'**il vaut mieux être un garcon pour réussir**.

### L'importance d'internet 

Internet est aujourd'hui un outil qui peut parraître indispensable aux élèves. **Nous allons voir si l'accès à internet permet réellement aux élèves d'avoir de meilleures notes.**

```{r internet_grade, message = FALSE}

notesSiInternet <- dfMaths %>% filter(internet == "yes") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiInternet <- notesSiInternet[1,1]

notesSiPasInternet <- dfMaths %>% filter(internet == "no") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiPasInternet <- notesSiPasInternet[1,1]
```

On remarque que la moyenne des notes des élèves ayant internet : **`r round(notesSiInternet, digits=2)`** est bien plus élevé que la moyenne des notes des élèves n'ayant pas internet : **`r round(notesSiPasInternet, digits=2)`**. **L'accès à internet** est donc **important** dans la réussite scolaire des élèves.

### Habiter en ville, un avantage ?

On peut se dire qu'habiter en ville est un avantage pour avoir avoir de meilleures notes, qui passe notamment par **un accès plus facile à la culture : musée, bibliothèque, cinéma... Mais est-ce vrai ?**

```{r address_grade, message = FALSE}
notesSiVille <- dfPortugais %>% filter(address == "U") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiVille <- notesSiVille[1,1]

notesSiCampagne <- dfPortugais %>% filter(address == "R") %>% select(Gmean) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(mean_Gmean)
notesSiCampagne <- notesSiCampagne[1,1]
```

On peut avoir accès également à la moyenne des notes des élèves venant de la ville : **`r round(notesSiVille, digits=2)`** et celle de ceux venant de la campagne : **`r round(notesSiCampagne, digits=2)`**. On peut voir qu'en général, **les personnes venant de la ville réussissent mieux que celles venant de la campagne**. <br>

### La nécessité de la proximité avec l'établissement 

Pour compléter cette comparaison des lieux de vie, on peut se dire que le temps de trajet joue un grand rôle dans la réussite des élèves, et qu'un temps de trajet plus court est favorable pour avoir de meilleures notes. **Est-ce vraiment un avantage d'habiter proche de son établissement scolaire ?**

```{r traveltime_grade, message = FALSE}
dfPortugais$traveltime <- as.factor(dfPortugais$traveltime)
#preparation des données
df <- dfPortugais %>% group_by(traveltime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(traveltime, mean_Gmean)

ggplot(df, aes(x = traveltime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = traveltime)) +
    labs(title = "Notes en fonction du temps de trajet", x = "Temps de trajet", y = "Moyenne des notes", fill = "Temps de trajet") +
    scale_fill_discrete(type = "viridis", name = "Temps de trajet", labels = c("1 : 0 - 15 mniutes", "2 : 15 - 30 mniutes","3 : 30 - 60 mniutes","4 : > 1 heure"))

```

Notre hypothèse est donc bien vérifiée ; **les notes baissent plus le temps de trajet est long**. 

### Le métier des parents influe-t-il sur les notes ?

Après nous être intéressés au sexe ainsi qu'au lieu de vie des étudiants, nous allons nous interessés au cadre familial et plus particulièrement au travail des parents. Nous pouvons penser que des parents travaillant dans l'éducation permet aux élèves d'avoir de meilleurs résultats. **Mais le travail des parents a-t-il un vrai impact sur les notes des élèves ?**

```{r fjob_grade, message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Fjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Fjob, mean_Gmean)

#Barplot 
fJob <- ggplot(df, aes(x = Fjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity", fill = viridis(5), alpha = .7) +
    labs(x = "Job du père", y = "Moyenne des notes", title = "Moyenne selon le travail du père") + 
    theme(legend.position = "none") +
    scale_x_discrete(labels = c("Au foyer","Santé", "Autre","Ser.Public","Education"))
```

```{r mjob_grade, message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Mjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Mjob, mean_Gmean)

#Barplot 
mJob <- ggplot(df, aes(x = Mjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity", fill = viridis(5), alpha = .7) +
    labs(x = "Job de la mère", y = "Gmean", title = "Moyenne selon le travail de la mère") + 
    theme(legend.position = "none") +
    scale_x_discrete(labels = c("Au foyer","Santé", "Autre","Ser.Public","Education"))

grid.arrange(fJob, mJob, ncol=2, nrow = 1)
```

On peut déceler que **le métier du père et de la mère ont bien une influence sur les notes de l'étudiant**.<br>
En effet, un **père professeur** amène généralement à de bien meilleurs résultats. Tandis que du côté de **la mère**, c'est **le travail dans la santé** qui permet d'avoir des meilleurs notes. On pourra voir par la suite si avoir une mère dans la santé implique être en bonne santé et donc conclure sur le fait qu'être en bonne santé a un impact direct sur les notes.

### Travailler plus pour gagner plus ?

Nous allons maintenant nous axer sur l'implication scolaire des étudiants : leur taux d'absence, leur volonté de faire des grandes études, s'il font du soutient scolaire, leur temps de travail...

**Est-ce que le fait de réviser plus est un vecteur pour avoir de meilleures notes ?**

```{r studytime_grade, message = FALSE}
dfPortugais$studytime <- as.factor(dfPortugais$studytime)
#preparation des données
df <- dfPortugais %>% group_by(studytime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(studytime, mean_Gmean)

ggplot(df, aes(x = studytime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = studytime)) +
    geom_line(color = "blue") +
    labs(title = "Notes en fonction du temps de travail", x = "Temps de travail", y = "Moyenne des notes") +
    scale_fill_discrete(type = "viridis", name = "Temps de travail", labels = c("1 : 0 - 2 heures", "2 : 2 - 5 heures","3 : 5 - 10 heures","4 : > 10 heures"))
    
```

On voit que **plus les élèves travaillent, meileures sont leurs notes**. Néanmoins, on voit que la différence n'est pas énorme, même négligeable, lorsque le temps de travail dépasse 10h. On pense alors que **travailler plus de 10h n'est pas utile pour avoir de bonnes notes**.


### Pour réussir, faut-il nécessairement aller en cours ?

Un des premiers points sur lequel on se penche est l'absentéisme. **Un gros taux d'absence entraine-t-il une chute des notes ?**

```{r absences_grade, message = FALSE}
#preparation des données
df <- dfMaths

ggplot(df, aes(x = absences, y = Gmean)) +
    geom_point() +
    geom_smooth() +
    labs(title = "Notes en fonction du nombre d'absences", x = "Absences", y = "Moyenne des notes") + 
    theme(legend.position = "none")

```

Le nombre d'individus ayant plus de 15 absences est trop faible et le graphique ne nous permet pas de conclure sur cela. Cependant, on voit **qu'en dessous de 15 absences, les résultats ne varient que très peu**.

### La volonté de faire des études supérieurs influe-t-elle ?

On peut également se demander si **le fait de vouloir faire des grandes études** implique que **l'élève se sent plus concerné scolairement** et donc que cela si **cela ressent au niveau des notes**.

```{r higher_grade, message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(higher) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(higher, mean_Gmean)

ggplot(df, aes(x = higher, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.8, aes(fill = higher)) +
    labs(title = "Notes en fonction de la volonté de faire des études supérieures", x = "Volonté de faire des études supérieures", y = "Moyenne des notes") +
  scale_fill_brewer(palette = "Pastel2") + 
    theme(legend.position = "none") +
  scale_x_discrete(labels = c("Non","Oui"))

```

En effet, on peut voir que la volonté de faire des études supérieures est **très corrélées** aux résultats.

### Le soutien scolaire, un vrai plus ?

Certains élèves bénéficient de soutient scolaire , qui est gratuit. Il y a également des élèves qui bénéficient de cours payants, que l'on peut assimiler à du soutient scolaire scolaire payant. Vaut-il mieux pour les élèves opter pour la version payante s'ils veulent avoir de meilleures notes.

```{r paid_schoolsup_grade, message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(paid) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(paid, mean_Gmean)

paid <- ggplot(df, aes(x = paid, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = paid)) +
    labs(title = "Notes selon soutien payant", x = "Soutien scolaire payant", y = "Moyenne des notes") +
    scale_fill_brewer(palette = "Pastel2") + 
    theme(legend.position = "none") +
    scale_x_discrete(labels = c("Non","Oui"))

#preparation des données
df <- dfMaths %>% group_by(schoolsup) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(schoolsup, mean_Gmean)

schoolsup <- ggplot(df, aes(x = schoolsup, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = schoolsup)) +
    labs(title = "Notes selon soutien gratuit", x = "Soutien scolaire gratuit", y = "Moyenne des notes") +
    scale_fill_brewer(palette = "Pastel2") +
    theme(legend.position = "none") + 
    scale_x_discrete(labels = c("Non","Oui"))

grid.arrange(schoolsup, paid, ncol=2, nrow = 1)

```

Les élèves ayant un **soutien scolaire gratuit**, donné par l'établissement semblent obtenir de **bien moins bons résultats** que les élèves ayant un **soutien scolaire payant**. On en conclut donc que la **version payante** du soutient scolaire est donc **bénéfique pour avoir de meilleures notes**.

### Les échecs ont-ils un impact sur les notes ?

Au cours de leur scolarité, certains élèves redoublent. Souvent cela se passe car ils ont de moins bons résultats que les autres élèves. Ces échecs passés influent-ils directement sur les notes actuelles de ces élèves ?  

```{r failures_grade, message = FALSE}
dfPortugais$failures <- as.factor(dfPortugais$failures)
#preparation des données
df <- dfPortugais %>% group_by(failures) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(failures, mean_Gmean)

ggplot(df, aes(x = failures, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = failures)) +
    labs(title = "Notes en fonction du redoublement", x = "Redoublement", y = "Moyenne des notes") +
    scale_fill_discrete(type = "viridis") +
    theme(legend.position = "none")

```

On peut voir que le nombre de redoublement d'un élève **influe directement** sur ses notes. En effet, ce sont **les élèves n'ayant jamais redoublé qui s'en sortent le mieux**. Cela semble logique !

### Le temps, important pour s'aérer l'esprit ?

Pour finir cette partie sur l'analyse des notes, nous allons voir comment les facteurs extra-scolaire peuvent influer sur les notes. 

**Est-il conseiller pour les élèves de prendre du temps libre après les cours ?**

```{r freetime_grade, message = FALSE}
dfPortugais$freetime <- as.factor(dfPortugais$freetime)
df <- dfPortugais %>% group_by(freetime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(freetime, mean_Gmean)

ggplot(df, aes(x = freetime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = freetime)) +
    geom_line(color = "blue") +
    labs(title = "Notes selon le temps libre", subtitle="1 : vraiment peu - 5 : vraiment beaucoup", x = "Temps libre", y = "Moyenne des notes") +
    scale_fill_discrete(type = "viridis") +
    theme(legend.position = "none")
  
```

On peut voir que **le fait de se libérer du temps libre est important pour réussir**. Néanmoins, ils doivent faire attention à ne pas en prendre trop pour ne pas voir leur moyenne chuter.

### L'alcool c'est de l'eau ?

Le lycée, c'est le moment où les élèves commencent à faire leurs premières soirées. Et qui dit premières soirées, dit premières consommation d'alcool (et premières cuites...). **L'alcool est-il néfaste sur le plan scolaire pour les élèves ? Est-ce la même conclusion pour l'alcool en semaine et le week-end ?**

```{r alc_grade, message = FALSE}
dfPortugais$Walc <- as.factor(dfPortugais$Walc)
df <- dfPortugais %>% group_by(Walc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Walc, mean_Gmean)

Walc <- ggplot(df, aes(x = Walc, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Walc)) +
    geom_line(color = "blue") +
    labs(title = "Notes selon cons. alc. week-end", subtitle="1 : vraiment peu - 5 : vraiment beaucoup", x = "Consommation d'alcool le week-end", y = "Moyenne des notes") +
    scale_fill_discrete(type = "viridis") +
    theme(legend.position = "none")
  
dfPortugais$Dalc <- as.factor(dfPortugais$Dalc)
df <- dfPortugais %>% group_by(Dalc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Dalc, mean_Gmean)

Dalc <- ggplot(df, aes(x = Dalc, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Dalc)) +
    geom_line(color = "blue") +
    labs(title = "Notes selon cons. alc. semaine", subtitle="1 : vraiment peu - 5 : vraiment beaucoup", x = "Consommation d'alcool en semaine", y = "Moyenne des notes", fill = "conso d'alcool") +
    scale_fill_discrete(type = "viridis") + 
    theme(legend.position = "none")
grid.arrange(Walc, Dalc, ncol=2, nrow = 1)

```

On peut voir que **la consommation d'alcool le weekend a clairement un impact sur les notes** et que ce sont **ceux qui en consomment peu** (niveau 1 ou 2) qui **ont les meilleures résultats**. On peut donc considérer qu'**il est préférable de ne pas consommer d'alcool le weekend, ou simplement un petit verre, pour avoir les meilleurs notes** (s'amuser le weekend pour relacher les cours par exemple).<br>

L'impact de la **consommation d'alcool en semaine** semble encore **plus lourde**. Ceux qui ne consomment pas du tout d'alcool la semaine **obtienent les meilleures notes**, et de loin. Cependant, **quitte à boire beaucoup de l'alcool en semaine, autant en boire énormément** car le niveau 5 (vraiment beaucoup) obtient des meilleures notes que le niveau 4 (beaucoup). Les résultats du niveau 5 sont sûrement tronquées par le fait que peu d'élèves soient à ce niveau, la représentativité est donc faible.

### Conclusion sur l'élève modèle

Enfin, on peut dire que nous avons pu déceler certains critères pour être l'élève modèle, ayant les meilleurs résultats. Il doit : 
<ul>
  <li>Avoir un **père** travaillant en tant que **professeur** et/ou une **mère** dans la **santé**</li>
  <li>Être un **garçon** (conclusion très théorique, basé uniquement sur les données)</li>
  <li>Se dégager **un peu de temps libre** pour s'aérer l'esprit</li>
  <li>Travailler de manière conséquente, mais **ne pas abuser du temps passé à étudier**</li>
  <li>Ne surtout **pas consommer d'alcool en semaine** et **ne pas en consommer avec excès le weekend**</li>
  <li>On **imagine qu'un taux d'absentéisme élevé engendre des moins bonnes notes** mais le dataset ne nous a pas permi de conclure là-dessus</li>
  <li>Avoir comme souhait de **faire des études supérieurs**</li>
  <li>Obtenir un **soutien scolaire payant**</li>
  <li>Ne **jamais avoir eu d'échec**</li>
</ul>

<hr>

# Comment être l'élève qui s'entend le mieux avec sa famille ?

Après avoir vu quels critères permettaient à un élève d'avoir les meilleures notes, nous allons nous interessés dans ce second axe de recherche aux critères qui permettent d'avoir de bonne relations familiales.

<!-- Calcul des moyennes utiles à l'analyse des relations -->

```{r calcul_moyenne_famrel, message = FALSE}
#Moyenne générale des relations familales
total_famrel <- dfPortugais$famrel
mean_famrel <- round(mean(total_famrel), digits=2)

#Moyenne générale des relations familales selon le sexe
#Moyenne générale des relations familales pour les garçons
total_famrel_M <- dfPortugais %>%
  select(famrel, sex) %>%
  filter(sex == 'M')
total_famrel_M <- total_famrel_M$famrel
mean_famrel_M <- round(mean(total_famrel_M), digits=2)
#Moyenne générale des relations familales pour les filles
total_famrel_F <- dfPortugais %>%
  select(famrel, sex) %>%
  filter(sex == 'F')
total_famrel_F <- total_famrel_F$famrel
mean_famrel_F <- round(mean(total_famrel_F), digits=2)

#Moyenne générale des relations familales selon le lieu d'habitation
#Moyenne générale des relations familales pour les étudiants de la campagne
total_famrel_R <- dfPortugais %>%
  select(famrel, address) %>%
  filter(address == 'R')
total_famrel_R <- total_famrel_R$famrel
mean_famrel_R <- round(mean(total_famrel_R), digits=2)
#Moyenne générale des relations familales pour les étudiants de la ville
total_famrel_U <- dfPortugais %>%
  select(famrel, address) %>%
  filter(address == 'U')
total_famrel_U <- total_famrel_U$famrel
mean_famrel_U <- round(mean(total_famrel_U), digits=2)

#Moyenne générale des relations familales selon le statut marital des parents
#Moyenne générale des relations familales pour les étudiants ayant des parents séparés
total_famrel_PSA <- dfPortugais %>%
  select(famrel, Pstatus) %>%
  filter(Pstatus == 'A')
total_famrel_PSA <- total_famrel_PSA$famrel
mean_famrel_PSA <- round(mean(total_famrel_PSA), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant des parents ensembles
total_famrel_PST <- dfPortugais %>%
  select(famrel, Pstatus) %>%
  filter(Pstatus == 'T')
total_famrel_PST <- total_famrel_PST$famrel
mean_famrel_PST <- round(mean(total_famrel_PST), digits=2)

#Moyenne générale des relations familales selon l'âge
#Moyenne générale des relations familales pour les étudiants ayant 15 ans
total_famrel_15 <- dfPortugais %>%
  select(famrel, age) %>%
  filter(age == 15)
total_famrel_15 <- total_famrel_15$famrel
mean_famrel_15 <- round(mean(total_famrel_15), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant 16 ans
total_famrel_16 <- dfPortugais %>%
  select(famrel, age) %>%
  filter(age == 16)
total_famrel_16 <- total_famrel_16$famrel
mean_famrel_16 <- round(mean(total_famrel_16), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant 17 ans
total_famrel_17 <- dfPortugais %>%
  select(famrel, age) %>%
  filter(age == 17)
total_famrel_17 <- total_famrel_17$famrel
mean_famrel_17 <- round(mean(total_famrel_17), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant 19 ans
total_famrel_19 <- dfPortugais %>%
  select(famrel, age) %>%
  filter(age == 19)
total_famrel_19 <- total_famrel_19$famrel
mean_famrel_19 <- round(mean(total_famrel_19), digits=2)

#Moyenne générale des relations familales selon la taille de la famille
#Moyenne générale des relations familales pour les étudiants ayant une famille < ou = à 3 personnes
total_famrel_FSLE3 <- dfPortugais %>%
  select(famrel, famsize) %>%
  filter(famsize == 'LE3')
total_famrel_FSLE3 <- total_famrel_FSLE3$famrel
mean_famrel_FSLE3 <- round(mean(total_famrel_FSLE3), digits=2)
#Moyenne générale des relations familales pour les étudiants ayant une famille > à 3 personnes
total_famrel_FSGT3 <- dfPortugais %>%
  select(famrel, famsize) %>%
  filter(famsize == 'GT3')
total_famrel_FSGT3 <- total_famrel_FSGT3$famrel
mean_famrel_FSGT3 <- round(mean(total_famrel_FSGT3), digits=2)

#Moyenne générale des relations familales selon le tuteur légal
#Moyenne générale des relations familales quand le père est tuteur
total_famrel_GF <- dfPortugais %>%
  select(famrel, guardian) %>%
  filter(guardian == 'father')
total_famrel_GF <- total_famrel_GF$famrel
mean_famrel_GF <- round(mean(total_famrel_GF), digits=2)
#Moyenne générale des relations familales quand la mère est tuteur
total_famrel_GM <- dfPortugais %>%
  select(famrel, guardian) %>%
  filter(guardian == 'mother')
total_famrel_GM <- total_famrel_GM$famrel
mean_famrel_GM <- round(mean(total_famrel_GM), digits=2)
#Moyenne générale des relations familales quand la mère "other" est tuteur
total_famrel_GO <- dfPortugais %>%
  select(famrel, guardian) %>%
  filter(guardian == 'other')
total_famrel_GO <- total_famrel_GO$famrel
mean_famrel_GO <- round(mean(total_famrel_GO), digits=2)
```

### Comment varient les relations familiales ?

Dans les datasets, les relations familailes sont évaluées de 1 à 5. 1 signifiant que les relations familiales sont très mauvaises, tandis que 5 signifie qu'elles sont excellentes. <br>
Pour les élèves que nous étudions, la moyenne des relations familiales est de **`r mean_famrel`**. Le graphique ci-dessous permet de bien visualiser la réparition des relations familiales.

```{r famrel, message = FALSE}
ggplot(dfPortugais, aes(x = famrel)) + 
    geom_bar(alpha = 0.7, fill = viridis(5))+
    labs(x = "Relations familiales" , y = "Nombre d'étudiants" ,title = "Répartitions des relations familiales")
```

### Le lieu de vie a-t-il un impact sur les relations familiales ?

Nous allons tout d'abord voir le sexe ou le lieu de vie peut avoir un impact sur les relations familiales. Les gens habitants à la campagne ont plus souvent une grande partie de leur famille habitant près de chez eux (grands-parents, oncle & tante, cousins & cousines). On peut donc penser que les relations familiales sont plus fortes pour les ruraux.

```{r sex_adress_famrel, message = FALSE}
df <- dfPortugais %>% select(address, famrel)

plot1 <- ggplot(df, aes(x = address, y = famrel)) + 
  geom_violin(aes(fill = address),alpha = 0.6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  labs(title = "Relations familiales selon l'adresse", x = "Adresse", y = "Moyenne des relations familiales") +
  scale_x_discrete(labels = c("Campagne","Ville")) + 
  theme(legend.position = "none")

df <- dfPortugais %>% select(sex, famrel)

plot2 <- ggplot(df, aes(x = sex, y = famrel)) + 
  geom_violin(aes(fill = sex),alpha = 0.6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  labs(title = "Relations familiales selon le sexe", x = "Sexe", y = "Moyenne des relations familiales") +
  scale_x_discrete(labels = c("Fille","Garçons")) + 
  theme(legend.position = "none")

grid.arrange(plot1, plot2, ncol=2, nrow = 1)
```

La moyenne des relations familiales chez les garçons est de  **`r mean_famrel_M`** tandis que chez les filles elle est de **`r mean_famrel_F`**.
Par rapport au lieu de vie, la moyenne des relations familiales des élèves habitant à la campagne est de  **`r mean_famrel_R`** tandis que chez les élèves habitant en ville, elle est de **`r mean_famrel_U`**.

Le sexe et le lieu de vie font peu varier les relations familiales. Néanmoins, on peut remarquer qu'en moyenne **les garçons ont de meilleures relations familiales** et faire la même remarque pour **les étudiants ruraux**.

### L'adolescence, le déclin de la bonne entente familiales ?

Arrivé à l'adolescence, les relations familiales deviennent souvent plus tendues entre les enfants et les parents. Nous pouvons donc émettre qu'**avec l'âge les relations familiales se dégradent**. 

```{r age_famrel, message = FALSE}
dfPortugais <- dfPortugais %>% filter (age != 21, age != 22)
dfPortugais$age <- as.factor(dfPortugais$age)
df <- dfPortugais %>% group_by(age) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(age, mean_famrel)

ggplot(df, aes(x = age, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = age)) +
    labs(title = "Relation familiales selon l'âge", x = "Âge", y = "Moyenne des relations familiales") +
    scale_fill_discrete(type = "viridis") + 
    theme(legend.position = "none")
```

Vu le faible nombre d'étudiants ayant entre 20 et 22 ans, on ne se concentre que la fourchette d'âge 15-19 ans.<br> 
On peut voir que **plus les étudiants viellissent, plus leur relations familiales se détériorent**, notre théorie de base est donc bonne. De 17 à 20 ans, la moyenne des relations familiales passe de **`r mean_famrel_17`** à **`r mean_famrel_19`**.
Néanmoins, cette observation se retrouve un peu faussée par les étudiants de 16 ans, qui ont une moyenne de relations familiales à **`r mean_famrel_16`**, alors que pour ceux de 15 et 17 ans, elles sont respectivement de **`r mean_famrel_15`** et **`r mean_famrel_17`**.

### Les étudiants avec des parents divorcés ont-ils de moins bonnes relations familiales ?
Le statut marital des parents fait peu vairer les relations familailes. En effet, les étudiants avec des parents ensembles ont une moyenne de relation familiale qui est de **`r mean_famrel_PST`** tandis qu'elle est de **`r mean_famrel_PSA`** pour ceux qui ont leurs parents séparés. <br>
Avoir des **parents ensembles** permet donc quand même d'avoir de meilleures relations familiales.

Néanmoins, conjugué à d'autres paramètres, le statut marital des parents fait varier de façon plus concluantes les relations familiales des étudiants.

### Relations familiales selon la taille de la famille en prenant en compte le statut marital des parents

Nous allons voir dans un premier temps si la taille de la famille fait varier les relations familiales. Des familles avec peu d'enfant peut avoir des liens resserrés, tandis qu'une famille avec beaucoup d'enfants peut voir ses relations familiales varier selon l'entente entre les progénitures.<br>
Si on s'interesse seulement à la taille de la famille, les relations varient peu entre les familles de composées de 3 personnes ou moins **(`r mean_famrel_FSLE3`)**, et celle comptant plus de 3 personnes **(`r mean_famrel_FSGT3`)**. <br>
En revanche, regardons **si l'analyse devient plus intéressante en conjugant la taille de la famille et le statut marital des parents**.

```{r famsize_famrel, message = FALSE}
df <- dfPortugais %>% filter(Pstatus == "T") %>% group_by(famsize) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(famsize, mean_famrel)

dfFSPT <- ggplot(df, aes(x = famsize, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = famsize)) +
    labs(title = "Rel. fam. selon la taille de la famille",subtitle = "Parents ensembles", x = "Taille de la famille", y = "Moyenne des relations familiales") +
    scale_fill_discrete(type = "viridis") +
    scale_x_discrete(labels = c("Inférieur ou égal à 3 pers.","Supérieur à 3 personnes")) + 
    theme(legend.position = "none")

df <- dfPortugais %>% filter(Pstatus == "A") %>% group_by(famsize) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(famsize, mean_famrel)

dfFSPA <- ggplot(df, aes(x = famsize, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = famsize)) +
    labs(title = "Rel. fam. selon la taille de la famille",subtitle = "Parents séparés", x = "Taille de la famille", y = "Moyenne des relations familiales") +
    scale_fill_discrete(type = "viridis") +
    scale_x_discrete(labels = c("Inférieur ou égal à 3 pers.","Supérieur à 3 personnes")) + 
    theme(legend.position = "none")

grid.arrange(dfFSPT, dfFSPA, ncol=2, nrow = 1)
```


Les relations familiales par rapport à la taille de famille, suivant que les parents soient ensembles ou non, **les chiffres deviennent plus interessants** quand les parents sont séparés.<br>
Ces derniers ont de **meilleures relations familiales** lorsque la **taille de la famille est égale ou inférieure à 3**.

### L'impact du tuteur légal sur les relations familiales suivant que les parents soient ensemble ou non

Quand on s'interesse seulement aux relations familiales suivant le tuteur légal de l'élève, la moyenne varie peu (père : `r mean_famrel_GF`, mère : `r mean_famrel_GM`), sauf pour "autre" ou la moyenne est un poil plus bas (`r mean_famrel_GO`). <br>
Nous allons donc continuer l'analyse en conjugant  le statut marital des parents avec le tuteur légal. Dans **les familles séparés, le tuteur légal doit sûrement avoir un impact sur l'entente familiale**.

```{r guardian_famrel, message = FALSE}
df <- dfPortugais %>% filter(Pstatus == "T") %>% group_by(guardian) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(guardian, mean_famrel)

dfGPT <- ggplot(df, aes(x = guardian, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = guardian)) +
  labs(title = "Rel. familiales selon le tuteur légal",subtitle = "Parents ensembles", x = "Tuteur légal", y = "Moyenne des relations familiales") +
  scale_fill_discrete(type = "viridis") +
  scale_x_discrete(labels = c("Père","Mère","Autre")) + 
  theme(legend.position = "none")

df <- dfPortugais %>% filter(Pstatus == "A") %>% group_by(guardian) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(guardian, mean_famrel)
dfGPA <- ggplot(df, aes(x = guardian, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = guardian)) +
  labs(title = "Rel. familiales selon le tuteur légal",subtitle = "Parents séparés", x = "Tuteur légal", y = "Moyenne des relations familiales") +
  scale_fill_discrete(type = "viridis") +
  scale_x_discrete(labels = c("Père","Mère","Autre")) + 
  theme(legend.position = "none")

df <- dfPortugais %>% filter(Pstatus == "T") %>% group_by(guardian) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(guardian, mean_famrel)


grid.arrange(dfGPT, dfGPA, ncol=2, nrow = 1)
```

Pour des **parents ensembles**, les **relations familiales sont semblables** lorsque que le **père** ou la **mère** sont tuteurs. Cette même **moyenne est plus basse** quand c'est **quelqu'un d'autre** qui a le rôle de tuteur. <br>
En revanche, pour des parents séparés, le résultat est bien différent. Les **relations familiales sont au plus bas** quand c'est **le père le tuteur**, est **au plus haut** quand c'est **quelqu'un d'autre**.  

### Le travail des parents joue-t-il sur les relations familiales ?

Nous allons maintenant directement nous focus sur les parents. Premièrement, en s'interessant à leur travail. Est-ce que des parents sans métier ont une bonne relation dans leur famille ?<br>

```{r Pjob_famrel, message = FALSE}
df <- dfPortugais %>% group_by(Mjob) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Mjob, mean_famrel)

plot1 <- ggplot(df, aes(x = Mjob, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Mjob)) +
  labs(title = "Rel. fam. suivant le travail de la mère", x = "Travail", y = "Moyenne des relations familiales") +
  scale_fill_discrete(type = "viridis") +
  scale_x_discrete(labels = c("Au foyer","Santé","Autre", "Serv. Public", "Education")) + 
  theme(legend.position = "none")

df <- dfMaths%>% group_by(Fjob) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Fjob, mean_famrel)

plot2 <- ggplot(df, aes(x = Fjob, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Fjob)) +
  labs(title = "Rel. fam. suivant le travail du père", x = "Travail", y = "Moyenne des relations familiales") +
  scale_fill_discrete(type = "viridis") +
  scale_x_discrete(labels = c("Au foyer","Santé","Autre", "Serv. Public", "Education")) + 
  theme(legend.position = "none")

grid.arrange(plot2, plot1, ncol=2, nrow = 1)
```

Pour le père et la mère, on voit que les relations familiales sont mieux quand **l'un et l'autre** travaillent dans **le service public**.<br>
Pour **approfondir cette analyse**, nous allons regarder :
<ul>
  <li>quand le père travaille dans le service public, **quel est le travail préférentiel pour la mère**</li>
<li>quand la mère travaille dans le service public, **quel est le travail préférentiel pour le père**</li>
</ul>

```{r Pjob2_famrel }
df <- dfMaths %>% filter(Mjob == 'services') %>% group_by(Fjob) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Fjob, mean_famrel)

plot1 <- ggplot(df, aes(x = Fjob, y = mean_famrel)) + 
          geom_bar(stat = "identity", alpha = 0.7, aes(fill = Fjob)) +
          labs(title = "Rel. fam. suivant le travail du père", subtitle = "(maman dans le service public)", x = "Travail", y = "Moyenne des relations familiales", fill = "Travail") +
          scale_fill_discrete(type = "viridis")  +
          scale_x_discrete(labels = c("Au foyer","Santé","Autre", "Serv. Public", "Education")) + 
          theme(legend.position = "none")

df <- dfPortugais %>% filter(Fjob == 'services') %>% group_by(Mjob) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Mjob, mean_famrel)

plot2 <- ggplot(df, aes(x = Mjob, y = mean_famrel)) + 
            geom_bar(stat = "identity", alpha = 0.7, aes(fill = Mjob)) +
            labs(title = "Rel. fam. suivant le travail de la mère", subtitle = "(papa dans le service public)", x = "Travail", y = "Moyenne des relations familiales", fill = "Travail") +
            scale_fill_discrete(type = "viridis")  +
            scale_x_discrete(labels = c("Au foyer","Santé","Autre", "Serv. Public", "Education")) + 
            theme(legend.position = "none")

grid.arrange(plot1, plot2, ncol=2, nrow = 1)
```

Les résulatats sont sans appels !<br>
Quand **le père** travaille dans **le service public**, il vaut que **la mère soit au foyer** pour avoir des meilleures relations familiales. 
En revanche, quand c'est **la mère** qui travaille dans **le service public**, les relations familiales se portent mieux si **le père est professeur**.

### Les relations familiales sont-elles meilleures quand les parents ont fait de grandes études ?

Pour continuer sur l'étude des parents, nous allons nous interesser à leur niveau d'étude. **Est-ce que un haut niveau d'étude garantit de bonnes relations familiales ?**

```{r Pedu_famrel, message = FALSE}
#preparation des données
dfPortugais$Medu <- as.factor(dfPortugais$Medu)
df <- dfPortugais %>% group_by(Medu) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Medu, mean_famrel)

plot1 <- ggplot(df, aes(x = Medu, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Medu)) +
    labs(title = "Rel. fam. selon l'éducation de la mère", x = "Education", y = "Moyenne des relations familiales", fill = "Education") +
    scale_fill_discrete(labels = c("0 : Aucune", "1 : primaire", "2 : collège", "3 : lycée", "4 : Supérieur"), type = "viridis")

dfPortugais$Fedu <- as.factor(dfPortugais$Fedu)
df <- dfPortugais %>% group_by(Fedu) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Fedu, mean_famrel)

plot2 <- ggplot(df, aes(x = Fedu, y = mean_famrel)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Fedu)) +
    labs(title = "Rel. fam. selon l'éducation du père", x = "Education", y = "Moyenne des relations familiales", fill = "Education") +
    scale_fill_discrete(labels = c("0 : Aucune", "1 : primaire", "2 : collège", "3 : lycée", "4 : sup"), type = "viridis") 

grid.arrange(plot2, plot1, ncol=2, nrow = 1)
```

Pour le père, le niveau d'éducation **importe peu pour les relations familiales**. En revanche, pour **la mère**, il faut **au moins qu'elle soit allée en primaire** pour garantir de bonnes relations familiales. 

### La consomation d'alcool le week-end, un facteur de mauvaises relations familiales ?

Pour finir, nous allons voir si comme pour les notes, la consommation d'alcool a un impact négatif sur les notes.

```{r Walc_famrel, message = FALSE}
dfPortugais$Walc <- as.factor(dfPortugais$Walc)
df <- dfPortugais %>% group_by(Walc) %>% mutate(mean_famrel = mean(famrel)) %>% distinct(Walc, mean_famrel)

ggplot(df, aes(x = Walc, y = mean_famrel)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Walc)) +
  labs(title = "Relations familiales suivant la consommation d'alcool", subtitle="1 : vraiment peu - 5 : vraiment beaucoup",  x = "Consommation d'alcool (le week-end)", y = "Moyenne des relations familiales") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none")
```

Comment attendu, on remarque que **plus la consommation d'alcool est importante**, **moins** les relations familiales sont bonnes.

### Conclusion sur l'élève qui a les meilleures relations familiales

De ces analyses, nous avons pu déceler plusieurs critères qui permettent d'avoir de meilleures relations familiales :
<ul>
  <li>Être un **garçon**</li>
  <li>Habiter à la **campagne**</li>
  <li>L'âge n'est pas très concluant car cela varie d'une année à l'autre mais si **on aurait tendance à dire que les relations familiales se dégradent avec l'âge**.</li>
  <li>Avoir des parents **ensembles**</li>
  <li>Quand ils sont **divorcés**, ils vaut mieux être **moins de 4** dans la famille, et **ne pas avoir son père comme tuteur légal**</li>
  <li>Avoir **une mère travaillant dans le service public** et **un père au foyer** OU **un père travaillant dans le service public** et **une mère travaillant dans l'éducation**.</li>
  <li>Avoir une mère qui est **au moins allée en primaire**</li>
  <li>**Ne pas consommer d'alcool** (du moins le week-end)</li>
</ul>

<hr>

# Comment être l'élève en meilleure santé ?

Après nous être interessés aux notes et aux relations familiales des élèves, nous allons dans cette dernière partie s'interroger sur **les facteurs qui font qu'un élève est en bonne santé**.

La santé est quantifiée sur une échelle de 1 à 5, avec 1 signifiant **"vraiment mauvais"** et 5 **"excellent"**.

```{r health, message = FALSE}
data <- dfMaths %>% select(health) %>% 
  add_column(all = "yes")
statistics <- list("min" =  min(data$health),
                   "max" =  max(data$health),
                   "mean" =  mean(data$health),
                   "sd" =  sd(data$health)
                   )

mean =  round(statistics$mean, digits=2)
sd = round(statistics$sd, digits=2)

ggplot(data, aes(y = health)) +
  geom_violin(aes(x = "santé", fill = "purple"),width = 0.5, alpha = 0.5, size = 1) + 
  geom_boxplot(aes( x = "santé"), width = 0.1, colour = "grey", alpha = 0.2) +
  geom_hline(aes(yintercept =  statistics$mean, colour = "blue")) +
  annotate("text",x = "santé", y = statistics$mean + 0.1, label = "mean" ) +
  geom_hline(aes(yintercept =  statistics$mean - statistics$sd, colour = "red")) +
  annotate("text",x = "santé", y = statistics$mean - statistics$sd + 0.1, label = "mean - sd" ) +
  geom_hline(aes(yintercept =  statistics$mean + statistics$sd, colour = "red")) +
  annotate("text",x = "santé", y = statistics$mean + statistics$sd - 0.1, label = "mean + sd" ) +
  scale_fill_viridis(discrete = TRUE) +
  labs(title = "Répartition de l'état de Santé", x = "", y = "État de santé") + 
  theme(legend.position = "none")
```

L'état de santé moyen est **`r mean`** et l'écart type de **`r sd`**. La population est majoritairement en bonne santé.

### Quel est l'impact de la famille sur la santé des étudiants ?

Le cadre familial peut avoir des impacts sur l'état de santé des étudiants. **Est-ce que le statut marital des parents, ou bien le tutuer légal fait influe sur l'état de santé des étudiants ?**

```{r health_pstatus_guardian, message = FALSE}
data1 <- dfPortugais %>% group_by(Pstatus) %>% mutate(mean_health = mean(health)) %>% distinct(Pstatus, mean_health)

plot1 <- ggplot(data1, aes(x = Pstatus, y = mean_health)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Pstatus)) +
  labs(title = "Santé selon la nature de la famille", x = "Type de famille", y = "Moyenne de l'état de santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Parents ensembles", "Parents séparés"))

data2 <- dfPortugais %>% filter(Pstatus == 'A') %>% group_by(guardian) %>% mutate(mean_health = mean(health)) %>% distinct(guardian, mean_health)

plot2 <- ggplot(data2, aes(x = guardian, y = mean_health)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = guardian)) +
  labs(title = "Santé selon le tuteur", subtitle = "Familles séparées", x = "Tuteur légal", y = "Moyenne de l'état de santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Père", "Mère","Autre"))

grid.arrange(plot1, plot2, nrow = 1)
```

Nous aurions pu penser que des élèves avec des parents ensembles auraient une meilleure santé que ceux avec des parents séparés. **Mais les chiffres nous donnent tort**. <br>
<<<<<<< HEAD
En s'interessant de plus près aux familles avec des parents sépares, et que l'on s'interesse aux tuteurs on se rend compte que **les élèves éduqués par une mère seule ont plus de soucis de santé, décrochant de près d'un point** des 2 autres cas.<br>
Pour essayer d'expliquer cela, nous avons essayé de faire une étude sur l'emploi et l'éducation de ces mères seules. **On pourrait imaginer qu'elles n'occupent pas des métiers à haut revenu ou qu'elles n'ont pas faites de longues études**.
=======
En s'interessant de plus près aux familles monoparentales, et que l'on s'interesse aux tuteurs on se rend compte que **les élèves éduqués par une mère seule ou une personne tierce ont plus de soucis de santé, décrochant de près d'un point**4 du cas où le tuteur c'est le père.<br>
Pour essayer d'expliquer cela, nous avons essayé de faire une étude sur l'emploi et l'éducation de ces femmes seules (pour le cas des mères) à s'occuper de leurs enfants. On pourrait imaginer qu'elles n'occupent pas des métiers à haut revenu ou qu'elles n'ont pas faites de longues études.

>>>>>>> b7a9b5cf71e0c2d0a4a9486950bea42c9cd476c4

```{r health_separate_pjob_pedu, message = FALSE}
data1 <- dfMaths %>% filter(Pstatus == 'A', guardian == "mother") %>%
  select(Mjob) %>% count(Mjob)

data2 <- dfPortugais %>% filter(Pstatus == 'A') %>% group_by(Mjob) %>% mutate(mean_health = mean(health)) %>% distinct(Mjob, mean_health)

data3 <- dfMaths %>% filter(Pstatus == 'A', guardian == "mother") %>%
  select(Medu) %>% count(Medu)

data4 <- dfPortugais %>% filter(Pstatus == 'A') %>% group_by(Medu) %>% mutate(mean_health = mean(health)) %>% distinct(Medu, mean_health)

plot1 <- ggplot(data1, aes(area = n, fill = Mjob, label = Mjob)) + 
  geom_treemap() +
  geom_treemap_text(fontface = "italic", colour = "white", place = "centre") +
  scale_fill_discrete(name = "Secteur d'emploi", labels = c("Au foyer", "Santé","Autre","Services publics", "Enseignement"))  
  
plot2 <- ggplot(data2, aes(x = Mjob, y = mean_health)) +
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Mjob)) +
  labs(title = "Santé selon le métier de la mère", subtitle="Parents séparés", x = "Travail de la mère", y = "Moyenne de l'état de santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Au foyer", "Santé","Autre","Serv. Pub.", "Education"))

plot3 <- ggplot(data3, aes(area = n, fill = factor(Medu), label = Medu)) + 
  geom_treemap() +
  geom_treemap_text(fontface = "italic", colour = "white", place = "centre") +
  scale_fill_discrete(name = "Niveau d'études", labels = c("Aucune", "Primaire", "Collège","Lycée","Supérieur"))

plot4 <- ggplot(data4, aes(x = Medu, y = mean_health)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Medu)) +
  labs(title = "Santé selon l'éducation de la mère", subtitle="Parents séparés", x = "Études de la mère", y = "Moyenne de l'état de santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Aucune", "Primaire", "Collège","Lycée","Supérieur"))

grid.arrange(plot1, plot2, plot3, plot4, nrow = 2, ncol = 2)
```

<<<<<<< HEAD
In fine, on ne peut confirmer que la moitié de nos hypothèses. <br>
Pour ce qui est de l'emploi de la mère, celles exerçant des activités autres que dans les services publics, la santé et l'enseignement, qui sont aussi les plus nombreuses sont celles pour lesquelles on retrouve les moins bons états de santé chez les enfants.<br>
En ce qui concerne le niveau d'éducation, on est agréablement surpris de voir que les mères ayant les plus bas niveaux d'éducation s'en sortent le mieux.
=======
In fine, on ne peut confirmer nos hypothèses. Pour ce qui est de l'emploi de la mère, celles exerçant dans les services publics, occupant une part considérable sont celles pour lesquelles on retrouve les moins bons états de santé chez les enfants Il ne s'agit pourtant pas des métiers les moins lucratifs. En ce qui concerne le niveau d'éducation, on agréablement surpris de voir que les mères ayant les plus bas niveaux d'éducation s'en sortent le mieux.
>>>>>>> b7a9b5cf71e0c2d0a4a9486950bea42c9cd476c4

### Etat de santé selon la relation famlliale

Pour conitnuer sur l'étude de la famille, nous allons nous intéresser aux relations familiales. Nous partons sur l'idée selon laquelle **de mauvaises relations familiales ont des répercutions négatives sur la santé des élèves**.

```{r health_famrel, message = FALSE}
dfPortugais$famrel <- as.factor(dfPortugais$famrel)
#preparation des données
df <- dfPortugais %>% group_by(famrel) %>% mutate(mean_health = mean(health)) %>% distinct(famrel, mean_health)

ggplot(df, aes(x = famrel, y = mean_health)) +
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = famrel)) +
  labs(title = "Santé selon la relation familiale", x = "Relations familiales", y = "Moyenne de l'état de santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none")

```

<<<<<<< HEAD
Commen nous le pensions, les relations familiales ont un réel impact sur l'état de santé, qui s'améliore quand les relations familiales augmentent.
=======
En effet, nous voyons clairement une évolution progressive de la santé suivant la qualité de la relation familiale. Il faut cependant nuancer ce constat car les écarts ne sont pas très significatifs.
>>>>>>> b7a9b5cf71e0c2d0a4a9486950bea42c9cd476c4

### Quel est l'impact du travail des parents sur la santé des élèves?

Pour finit, nous allons nous interessés aux parents, et nous allons si l'état de santé varie selon le travail des parents.<br>
Les systèmes de santé étant assez bien développés en Europe en général, **nous ne nous attendons pas à avoir des différences significatives selon le métier des parents**.

```{r health_pjob, message = FALSE}
df <- dfPortugais %>% group_by(Mjob) %>% mutate(mean_health = mean(health)) %>% distinct(Mjob, mean_health)

plot1 <- ggplot(df, aes(x = Mjob, y = mean_health)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Mjob)) +
  labs(title = "Santé suivant le travail de la mère", x = "Travail", y = "Moyenne de l'état de santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Au foyer","Santé", "Autre","Serv.Public","Education"))

df2 <- dfPortugais %>% group_by(Fjob) %>% mutate(mean_health = mean(health)) %>% distinct(Fjob, mean_health)

plot2 <- ggplot(df2, aes(x = Fjob, y = mean_health)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Fjob)) +
  labs(title = "Santé suivant le travail du père", x = "Travail", y = "Moyenne de l'état de santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Au foyer","Santé", "Autre","Serv. Public","Education"))

grid.arrange(plot1, plot2, nrow = 1)
```

<<<<<<< HEAD
Dans le cas du père, on remarque que le fait qu'il travaille dans le domaine de la santé augmente drastiquement l'état de santé.
Le résultat est plus mitigé dans le cas de la mère, ou en plus du domaine de la santé, on distingue le domaine du service public qui permet d'avoir un bon état de santé.
=======
Effectivement, nous n'observons pas de gros écarts mais nous remarquons tout de même que les parents travaillant dans le secteur de la santé ont les enfants présentant les meilleurs résultats sur cet aspect,surtout quand il s'agit du père.

### Quel est l'impact de l'éducation des parents sur la santé des élèves?
>>>>>>> b7a9b5cf71e0c2d0a4a9486950bea42c9cd476c4

### Conclusion sur l'élèves qui a le meilleur état de santé

Nous nous sommes principalement concentrés sur l'impact de la famille sur l'état de santé car cela étaient les seuls analyses interessantes et pertinantes.

<<<<<<< HEAD
=======
plot1 <- ggplot(df, aes(x = Medu, y = mean_health)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Medu)) +
  labs(title = "Santé selon l'éducation de maman", x = "Niveau d'études", y = "Santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Aucune","Primaire","Collège","Lycée","Supérieur"))

df2 <- dfPortugais %>% group_by(Fedu) %>% mutate(mean_health = mean(health)) %>% distinct(Fedu, mean_health)

plot2 <- ggplot(df2, aes(x = Fedu, y = mean_health)) + 
  geom_bar(stat = "identity", alpha = 0.7, aes(fill = Fedu)) +
  labs(title = "Santé selon l'éducation de papa", x = "Niveau d'études", y = "Santé") +
  scale_fill_discrete(type = "viridis") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Aucune","Primaire","Collège","Lycée","Supérieur"))

grid.arrange(plot1, plot2, nrow = 1) 
```

On se rend compte après étude que l'hypothèse n'est pas complètement vérifiée et on observe des comportements différents selon le sexe du parent. Alors que la santé des enfants de mères ayant le plus bas niveau d'études est la meilleur, celle des pères ayant arrêté au Lycéeest moins bonne que celle des autres.

Conclusion sur l'état de santé
<hr>

Plusieurs critères permettent d'avoir une bonne santé. Il s'agit : 
>>>>>>> b7a9b5cf71e0c2d0a4a9486950bea42c9cd476c4
<ul>
  <li> La qualité de la relation familiale : **Mieux elle est, meilleure est la santé**</li>
  <li> Le travail des parents : On constate un meilleur état de santé lorsque le père ou la mère **travaillent dans le secteur de la santé**</li>
  <li> La nature de la famille : En prenant l'évènement contraire on voit que **les familles monoparentales où la garde est à la mère rencontre des difficultés** alors que **cela se passe relativement bien dans les autres cas**</li>
</ul>

# Conclusion

Pour conclure sur cette analyse, nous nous malheuresement pas réussi à identifier des critères qui permet d'avoir des bonnes notes, tout en ayant de bonnes relations familiales, et un bon état de santé. Sûrement car **l'étudiant parfait n'existe pas** ! <br>
Le point positif sur notre dataset est qu’il a été **plaisant** et **intéressant** à analyser. Des analyses ont validées nos théories, tandis que d’autres les ont réfutées.<br>
En revanche, pour **le point noir** de ce dataset, nous pouvons notifier qu’**il nous manquait des valeurs continue**. En effet, la seule valeur continue que nous avions est la moyenne générale que nous avons du créer. **Ce manque de diversité dans nos variables nous a obligé à faire presque que le même type de plot** (diagramme en barre).<br>
Avant de finir sur nos remarques personnelles, nous pouvons conclure quant au projet en lui même. Malgré l’aspect distanciel, **le projet pour notre part s’est très bien déroulé**. L’utilisation de GitHub a facilité cela, tout comme la mise en place d’un chanel Discord qui a permis de bien communiquer.
**Les 3 axes de recherche nous ont permis de bien nous répartir le travail, sans empiéter sur celui des autres.**

### Conclusion personnelle
<ul>
  <li>**Oscar** : L’UE était plaisante et au goût du jour avec des outils très actuels utilisés dans la data visualisation, le projet est vraiment plaisant à réaliser et permet de bien prendre en main le langage R pour la datavizz. La chose qui pourrait je pense améliorer cette UE serait de passer un peu plus de temps sur un outil de BI (Tableau ou PowerBI), peut-être n’en choisir qu’un des deux et l’approfondir sur 3 semaines ou plus car ce sont des outils très utilisés en entreprise.</li>
<<<<<<< HEAD
  <li>**Albert** :</li>
  <li>**Clément** : Sûrement l'une des UE les plus interessantes que j'ai suivie à l'UTT, et en tout la mieux organisée que j'ai pu faire depuis la mise en place des cours à distance. Réaliser un projet sur les 2/3 du semestre permet de bien appréhender et appliquer les différentes notions vues en cours ; sur les points que j'ai particulièrement bien aimé je peux notifier les cours qui concerne la perception et le regard sur les graphes (cours sur la sémiologie et l'éthique), en revanche je regrette la pauvreté dans nos variables ce qui nous a contraint d'une redondance sur nos types de plots ainsi que sur la Shinyapp.</li>
=======
  <li>**ALbert** :L'UE était très enrichissante. L'approche adoptée, mettant l'accent sur des aspects de sémiologie, d'histoire et de compréhension des enjeuux cognitifsderrière la visualisation des données était fort surprenante dans le sens agréable du terme. Aussi, l'UE, par l'introduction à des technologies comme Power BI, Tableau a permis d'aller explorer d'autres solutions utiles en entreprise. Enfin, la pédagogie était parfaite.</li>
  <li>**Clément** :</li>
>>>>>>> b7a9b5cf71e0c2d0a4a9486950bea42c9cd476c4
</ul>

