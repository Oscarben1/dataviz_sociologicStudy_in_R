---
title: "RmrkdOscar"
author: "Oscar"
date: "23/04/2021"
output: html_document
---

Importons ici toutes les libraries utiles à notre projet
```{r message = FALSE}
library(readr)
library(ggplot2)
library(dplyr)
library(scales)
```


A METTRE OU PAS ?????

REPARTITION HOMME - FEMME DANS LES ECOLES

```{r repHommeFemme, message = FALSE}

ggplot(dfMaths, aes(x = school, fill = sex)) + 
  geom_bar(position = position_dodge(0.9), alpha = 0.6, fill = viridis(2)) + 
  labs(fill = "Sexe", x = "Ecole", y = "Effectifs", title = "Part des effectifs Masculins et Féminins dans chaque école")
```






Importons dans un premier temps les datasets

```{r message = FALSE}
dfMaths <- read_csv("data/student-mat.csv")
dfMaths <- dfMaths %>% filter(age < 20)

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfMaths %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfMaths <- cbind(dfMaths, temp) %>% rename('Gmean' = `rowSums(temp)/3`)

#Visualisation du dataset
head(dfMaths)

dfPortugais <- read_csv("data/student-por.csv")
dfPortugais <- dfPortugais

#ajout d'une colonne de moyenne des 3 notes :
temp <- dfPortugais %>% select(G1,G2,G3)
temp <- as.data.frame(rowSums(temp)/3)
dfPortugais <- cbind(dfPortugais, temp) %>% rename('Gmean' = `rowSums(temp)/3`)
head(dfPortugais)
```

Regardons l'influence du sexe sur les résultats à l'école, en maths et en portugais

----------------------------------------------------------

Tout d'abord, regardons les effectifs dans les différentes écoles pour avoir une vue d'ensemble

```{r message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(internet) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(internet, mean_Gmean)

#Barplot 
ggplot(df, aes(x = internet, y = mean_Gmean)) + 
    geom_bar(stat = "identity") +
    scale_fill_brewer(palette = "Dark2") + 
    labs(x = "Adress", y = "Gmean",title = "Part des effectifs Masculins et Féminins selon l'âge")
```

```{r message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(address) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(address, mean_Gmean)

#Barplot 
ggplot(df, aes(x = address, y = mean_Gmean)) + 
    geom_bar(stat = "identity") +
    scale_fill_brewer(palette = "Dark2") + 
    labs(x = "Adress", y = "Gmean",title = "Part des effectifs Masculins et Féminins selon l'âge")
```

```{r message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Fjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Fjob, mean_Gmean)

#Barplot 
ggplot(df, aes(x = Fjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity") +
    scale_fill_brewer(palette = "Dark2") + 
    labs(x = "Adress", y = "Gmean",title = "Part des effectifs Masculins et Féminins selon l'âge")
```

```{r message = FALSE}
#préparation des données
df <- dfMaths %>% group_by(Mjob) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Mjob, mean_Gmean)

#Barplot 
ggplot(df, aes(x = Mjob, y = mean_Gmean)) + 
    geom_bar(stat = "identity") +
    scale_fill_brewer(palette = "Dark2") + 
    labs(x = "Adress", y = "Gmean",title = "Part des effectifs Masculins et Féminins selon l'âge")
```



```{r message = FALSE}

ggplot(dfMaths, aes(x = school, fill = sex)) + 
  geom_bar(position = position_dodge(0.9), alpha = 0.6) + 
  scale_fill_brewer(palette = "Dark2") + 
  labs(fill = "Sexe", x = "Ecole", y = "Effectifs", title = "Part des effectifs Masculins et Féminins dans chaque école")
```

Regardons le nombre d'heures travaillées selon le genre

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% select(sex, studytime)

#BoxPlot
ggplot(df, aes(x = sex, y = studytime)) + 
  geom_boxplot(aes(fill = sex),alpha = 0.6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  ggtitle("Répartition du temps de travail en fonction du genre")

```

On peut voir que les filles travaillent généralement plus que les garcons en maths dans notre dataset dfMaths. On peut alors se dire que le travail paye et qu'elles doivent obtenir de meilleurs résultats dans cette matière. Verifions le.

Regardons la note finale selon le genre, en mathématiques

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% select(sex, Gmean)

#BoxPlot
ggplot(df, aes(x = sex, y = Gmean)) + 
  geom_boxplot(aes(fill = sex),alpha = .6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  ggtitle("Répartition des notes en fonction du genre")
  
```

Le graph nous montre que la moyenne des notes des garcons en maths est plus élevée que celle des filles, ce qui est étonnant puisque ces derniers travaillent moins que les filles. On peut se dire qu'être un garcon est un avantage pour être l'élève modèle en maths.

Réalisons la même étude pour le portugais.

BoxPlot repartition du temps de travail selon le sexe en matiere de portugais

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% select(sex, studytime)

#BoxPlot
ggplot(df, aes(x = sex, y = studytime)) + 
  geom_boxplot(aes(fill = sex),alpha = 0.6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  ggtitle("Répartition du temps de travail en fonction du genre")

```

Les hommes travaillent en effet moins que les femmes en moyenne, en portugais également, mais cet écart se réduit pour la matière de portugais. Regardons le résultat sur les notes.

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% select(sex, Gmean)

#BoxPlot
ggplot(df, aes(x = sex, y = Gmean)) + 
  geom_boxplot(aes(fill = sex),alpha = .6,size = 1) + 
  stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white") +
  scale_fill_brewer(palette = "Dark2") +
  ggtitle("Répartition des notes en fonction du genre")
  

```

Cette fois-ci, le travail paye ! Les filles ont en effet de meilleurs résultats en portugais que les garcons.

Peut être que les filles sortent plus que les garcons ?

```{r}
df <- dfMaths %>% select(goout, sex);

ggplot(df, aes(x= goout, fill =sex)) +
    geom_density(alpha = 0.6) + 
    scale_fill_brewer(palette = "Dark2") +
    xlab("Fréquence de sorties") +
    labs(title="répartition de la fréquence de sorties chez les persones en couple")
```

Finlement, la fréquence des sorties est sensiblement pareil entre les filles et les garcons.

-----------------------------------

INFLUENCE DE L'AGE

On regarde tout d'abord la répartition des ages dans le dataset dfMaths

```{r}
#preparation des donnees
df <- dfMaths %>% select(age)

ggplot(df, aes(x = age)) +
  geom_bar(fill = "lightblue", alpha = 0.7)
```

On voit que les élèves de 20, 21 et 22 ans sont négligeables, on ne les prendra sonc pas en compte dans notre analyse.

On regarde la répartition des notes selon les ages en mathématiques.

```{r message = FALSE}
#preparation des données 
df <- dfMaths

#BoxPlot
df$age=factor(df$age)
  ggplot(df, aes(x=age, y=Gmean, fill=age)) +
    geom_boxplot(alpha = 0.6)+
    labs(title="Repartition des moyennes des notes selon l'age",x="age", y = "Note finale") +
    scale_fill_brewer(palette = "Dark2") +
    stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white")  
```

On distingue que dans les ages bas (15,16 et 17), les notes sont sensiblement les mêmes, des variations opèrent dans les ages plus avancés notamment ceux de 20 ans qui obtiennent de bien meilleurs résultats en maths. Dans ce cas, avoir 20 ans est un avantage pour être l'élève modèle.

Regardons si la répartition est la même pour le portugais
```{r message = FALSE}
#preparation des données 
df <- dfPortugais %>% filter(age < 20)

#BoxPlot
df$age=factor(df$age)
  ggplot(df, aes(x=age, y=Gmean, fill=age)) +
    geom_boxplot(alpha = 0.6)+
    labs(title="Repartition des moyennes des notes selon l'age",x="age", y = "Note finale") +
    scale_fill_brewer(palette = "Dark2") +
    stat_summary(fun = "mean", geom = "point", shape= 21, size= 2, fill= "white")  
```

On distingue toujours que dans les ages bas (15,16 et 17), les notes sont sensiblement les mêmes, cependant, les variations n'opèrent pas forcément comme pour les mathématiques, cette fois les moyennes des notes en portugais selon les ages sont sensiblement les mêmes.

```{r message = FALSE}
df <- dfPortugais %>% group_by(age) %>% mutate(mean_freetime = mean(freetime)) %>% distinct(age, mean_freetime)

ggplot(df, aes(x = age, y = mean_freetime)) +
    geom_bar(stat = "identity", fill = "lightblue", alpha = 0.6) +
    geom_line(color = "red") +
    labs(x = "Age", y = "Temps libre moyen", title = "temps libre en fonction de l'âge")
    scale_fill_brewer(palette = "Dark2") 
  
```

Le freetime est le même environ, quelque soit l'age. On peut se demander si avoir du temps libre signifie être moins impliqué dans ses études et donc avoir de moins bonnes notes, ou si, au contraire, se dégager du temps libre est synonyme d'organisation et donc de réussite scolaire : 

```{r message = FALSE}
df <- dfPortugais %>% group_by(freetime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(freetime, mean_Gmean)

ggplot(df, aes(x = freetime, y = mean_Gmean)) +
     geom_bar(stat = "identity", fill = "lightblue", alpha = 0.8) +
     geom_line(color = "red") +
     labs(x = "Consommation d'alcool le weekend", y = "Moyenne des notes", title = "Notes en fonctions de la consommation d'alcool le weekend")
  
```


Regardons la consommation d'alcool. On prend ici en compte les plus de 20 ans pour se faire une idée plus globale bien que cette population ne soit pas représentative, on utilise le dataset portugais pour avoir plus d'individus.

```{r message = FALSE}
df <- dfPortugais %>% group_by(age) %>% mutate(mean_Walc = mean(Walc)) %>% distinct(age, mean_Walc)

ggplot(df, aes(x = age, y = mean_Walc)) +
    geom_bar(stat = "identity", fill = "lightblue", alpha = 0.8) +
    geom_line(color = "red") +
    labs(x = "Age", y = "Consommation d'alcool", title = "Consommation d'alcool en fonction de l'âge") +
    scale_fill_brewer(palette = "Dark2") 
  
```

On voit clairement qu'après 20 ans, la consommation augmente, cependant, dans les âges les plus représentés de notre dataset (15, 16, 17, 18, 19), la consommation semble assez similaire bien qu'il y ait un pic léger pour les 17 ans.

On peut désormais regarder si la consommation d'alcool a une influence direct sur les notes ou pas ?

```{r message = FALSE}
df <- dfPortugais %>% group_by(Walc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Walc, mean_Gmean)

ggplot(df, aes(x = Walc, y = mean_Gmean)) +
     geom_bar(stat = "identity", fill = "lightblue", alpha = 0.8) +
     geom_line(color = "red") +
     labs(x = "Consommation d'alcool le weekend", y = "Moyenne des notes", title = "Notes en fonctions de la consommation d'alcool le weekend")
  
```

On peut voir que la consommation d'alcool a clairement un impact sur les notes et que ce sont ceux qui en consomment peu (niveau 2) qui ont les meilleures résultats. On peut donc considérer qu'il faut boire mais très peu, pour avoir les meilleurs notes (s'amuser le weekend pour relacher les cours par exemple).

Voyons maintenant si la consommation d'alcool la semaine a un gros impact : 

```{r message = FALSE}
df <- dfPortugais %>% group_by(Dalc) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Dalc, mean_Gmean)

ggplot(df, aes(x = Dalc, y = mean_Gmean)) +
     geom_bar(stat = "identity", fill = "lightblue", alpha = 0.8) +
     geom_line(color = "red") +
     labs(x = "Consommation d'alcool en semaine", y = "Moyenne des notes", title = "Moyenne des notes en fonctions de la consommation d'alcool en semaine")
```

L'impact de la consommation d'alcool en semaine semble encore plus lourd, cette fois si, le niveau 1 de consommation (pas de consommation) est celui qui obtient les meilleures notes.

Voyons maintenant si le temps de travail implique des meilleurs notes, en maths :

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(studytime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(studytime, mean_Gmean)

ggplot(df, aes(x = studytime, y = mean_Gmean)) +
    geom_bar(stat = "identity", fill = "lightblue", alpha = 0.7) +
    geom_line(color = "blue") +
    labs(title = "Notes en fonction du temps de travail en maths", x = "temps de travail", y = "moyenne des notes")

```

On voit que plus es élèves travaillent, meileures sont leurs notes, cependant, on voit que la différence n'est pas énorme (voire négligeable) entre 3h et 4h.

Voyons pour le portugais : 

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(studytime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(studytime, mean_Gmean)

ggplot(df, aes(x = studytime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = studytime)) +
    geom_line(color = "blue") +
    labs(title = "Notes en fonction du temps de travail en Portugais", x = "temps de travail", y = "moyenne des notes", fill = "Temps de travail") +
    scale_fill_continuous(labels = c("1 : très peu", "2 : modérément", "3 : suffisamment", "4 : beaucoup"), type = "viridis")

```

Meme constat pour le portugais. On peut se dire que pour optimiser son temps, ne travailler que 3h et profiter de l'heure restant pour se détendre ou faire du sport est surement la bonne solution.

CORRELATION : 

```{r}
library(corrplot)
df <- dfMaths %>% select(age, Medu, Fedu,traveltime, studytime, failures, famrel,freetime,Dalc,Walc,health,absences,Gmean)

mcor <- cor(df)
corrplot(mcor, type="upper", order="hclust", tl.col="black", tl.srt=45)

```

AJOUT DES PLOTS EN FONCTION DES NOTES

ECOLE
```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(school) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(school, mean_Gmean)

ggplot(df, aes(x = school, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = school)) +
    labs(title = "Notes en fonction de l'école en Maths", x = "école", y = "moyenne des notes", fill = "école")

```

FAMSIZE 

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(famsize) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(famsize, mean_Gmean)

ggplot(df, aes(x = famsize, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = famsize)) +
    labs(title = "Notes en fonction de la taille de la famille en Portugais", x = "Taille de la famille", y = "moyenne des notes", fill = "Taille de la famille")

```

PSTATUS

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(Pstatus) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(Pstatus, mean_Gmean)

ggplot(df, aes(x = Pstatus, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = Pstatus)) +
    labs(title = "Notes en fonction du statut des parents en Portugais", x = "statut des parents", y = "moyenne des notes", fill = "statut des parents")

```

REASON WHY HAVING CHOSEN THIS SCHOOL

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(reason) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(reason, mean_Gmean)

ggplot(df, aes(x = reason, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = reason)) +
    labs(title = "Notes en fonction de la raison du choix de l'école en Portugais", x = "raison du choix", y = "moyenne des notes", fill = "raison du choix") +
    scale_fill_discrete(labels = c("préférence de cours", "prox du domicile", "autre", "réputation de l'école"), type = "viridis")

```

TRAVEL TIME 

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(traveltime) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(traveltime, mean_Gmean)

ggplot(df, aes(x = traveltime, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = traveltime)) +
    labs(title = "Notes en fonction du temps de trajet en Portugais", x = "traveltime", y = "moyenne des notes", fill = "traveltime") +
    scale_fill_continuous(labels = c("1 : court", "2 : passable", "3 : long", "4 : très long"), type = "viridis")

```

FAILURES

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(failures) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(failures, mean_Gmean)

ggplot(df, aes(x = failures, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = failures)) +
    labs(title = "Notes en fonction du temps de trajet en Portugais", x = "failures", y = "moyenne des notes", fill = "nb de failures")

```

SOUTIEN SCOLAIRE

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(schoolsup) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(schoolsup, mean_Gmean)

ggplot(df, aes(x = schoolsup, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = schoolsup)) +
    labs(title = "Notes en fonction du soutien scolaire en Maths", x = "soutien scolaire", y = "moyenne des notes", fill = "Soutien scolaire")

```

SOUTIEN SCOLAIRE FAMILIAL

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(famsup) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(famsup, mean_Gmean)

ggplot(df, aes(x = famsup, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = famsup)) +
    labs(title = "Notes en fonction du soutien scolaire de la famille en Maths", x = "soutien scolaire familial", y = "moyenne des notes", fill = "Soutien scolaire familial")

```

SOUTIEN SCOLAIRE PAYANT

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(paid) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(paid, mean_Gmean)

ggplot(df, aes(x = paid, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = paid)) +
    labs(title = "Notes en fonction du soutien scolaire payant en Maths", x = "soutien scolaire payant", y = "moyenne des notes", fill = "Soutien scolaire payant")

```

ACTIVITES

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(activities) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(activities, mean_Gmean)

ggplot(df, aes(x = activities, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = activities)) +
    labs(title = "Notes en fonction de l'exercice d'une activité en Maths", x = "activité extra-scolaire", y = "moyenne des notes", fill = "activité extra-scolaire")

```

A ETE A L'ECOLE MATERNELLE

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(nursery) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(nursery, mean_Gmean)

ggplot(df, aes(x = nursery, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = nursery)) +
    labs(title = "Notes en fonction du passage en maternelle en Maths", x = "passage en maternelle", y = "moyenne des notes", fill = "passage en maternelle")

```

SOUHAIT DE FAIRE DES ETUDES SUP

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(higher) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(higher, mean_Gmean)

ggplot(df, aes(x = higher, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = higher)) +
    labs(title = "Notes en fonction de la volonté de faire des études sup en Maths", x = "volonté de faire des études sup", y = "moyenne des notes", fill = "volonté de faire des études sup")

```

EST EN COUPLE OU PAS

SOUHAIT DE FAIRE DES ETUDES SUP

```{r message = FALSE}
#preparation des données
df <- dfMaths %>% group_by(romantic) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(romantic, mean_Gmean)

ggplot(df, aes(x = romantic, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = romantic)) +
    labs(title = "Notes en fonction de la situation personnelle en Maths", x = "En couple ?", y = "moyenne des notes", fill = "En couple ?")

```

RELATIONS FAMILIALES (1- mauvaises à 5- excellentes)

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(famrel) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(famrel, mean_Gmean)

ggplot(df, aes(x = famrel, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = famrel)) +
    labs(title = "Notes en fonction des relations avec la famille en Portugais", x = "relations familiales", y = "moyenne des notes", fill = "relations familiale") +
    scale_fill_continuous(labels = c("1 : mauvaises", "2 : très moyennes", "3 : moyenne", "4 : bonnes", "5 : excellentes"), type = "viridis")

```

SANTE (1- mauvaises à 5- excellentes)

```{r message = FALSE}
#preparation des données
df <- dfPortugais %>% group_by(health) %>% mutate(mean_Gmean = mean(Gmean)) %>% distinct(health, mean_Gmean)

ggplot(df, aes(x = health, y = mean_Gmean)) +
    geom_bar(stat = "identity", alpha = 0.7, aes(fill = health)) +
    labs(title = "Notes en fonction de la santé en Portugais", x = "santé", y = "moyenne des notes", fill = "santé") +
    scale_fill_continuous(labels = c("1 : mauvaise", "2 : très moyenne", "3 : moyenne", "4 : bonne", "5 : excellente"), type = "viridis")

```

ABSENCES

```{r message = FALSE}
#preparation des données
df <- dfMaths

ggplot(df, aes(x = absences, y = Gmean)) +
    geom_point() +
    geom_smooth() +
    labs(title = "Notes en fonction du nb d'absences en maths", x = "absences", y = "moyenne des notes")

```
